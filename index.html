<!DOCTYPE html>
<html>
  <head>
    <title>Performance Timeline Book</title>
    <meta charset='utf-8'>
    <script src='http://www.w3.org/Tools/respec/respec-w3c-common' async class='remove'></script>
    <script class='remove'>
var respecConfig = {
  shortName: 'webperf-book',
  specStatus: 'ED',
  editors: [{
    name: 'Web Performance Working Group'
  }],
  wg: 'Web Performance Working Group',
  wgURI: 'http://www.w3.org/2010/webperf/',
  wgPublicList: 'public-web-perf',
  wgPatentURI:'http://www.w3.org/2004/01/pp-impl/45211/status'
};
  </script>
  </head>
  <body>
    <h1>Performance Timeline Book</h1>
    <section id='abstract'>
      <p>
        This is the Performance Timeline book.
      </p>
    </section>
    <section id='sotd'>
      <p>
        This document has no official standing and is generated by script.
      </p>
    </section>
<section><h2>High Resolution Time Level 2</h2>null</section><section><h2>Performance Timeline</h2>
    <p>This specification defines a unified interface to store and retrieve high resolution performance metric data.</p>
  <section id='informative' class='informative'>
    <h2>Introduction</h2>

    <p>Accurately measuring performance characteristics of web applications is an important aspect of making web applications faster. This specification defines the necessary <a>Performance Timeline</a> primitives that enable web developers to access, instrument, and retrieve various performance metrics from the full lifecycle of a web application.</p>

    <p>[[NAVIGATION-TIMING]], [[RESOURCE-TIMING]], and [[USER-TIMING]] are examples of specifications that define timing information related to the navigation of the document, resources on the page, and developer scripts, respectively. Together these and other performance interfaces define performance metrics that describe the <a>Performance Timeline</a> of a web application. For example, the following script shows how a developer can access the <a>Performance Timeline</a> to obtain performance metrics related to the navigation of the document, resources on the page, and developer scripts:</p>

    <pre class="highlight example">&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body onload="init()"&gt;
    &lt;img id="image0" src="http://www.w3.org/Icons/w3c_main.png" /&gt;
    &lt;script&gt;
       function init()
       {
            performance.mark("startWork"); // see [[User Timing]]
            doWork(); // Some developer code
            performance.mark("endWork");

            measurePerf();
       }

       function measurePerf()
       {
           var perfEntries = performance.getEntries();
           for (var i = 0; i &lt; perfEntries.length; i++)
           {
                 if (window.console) console.log("Name: "        + perfEntries[i].name      +
                                                 " Entry Type: " + perfEntries[i].entryType +
                                                 " Start Time: " + perfEntries[i].startTime +
                                                 " Duration: "   + perfEntries[i].duration  + "\n");
           }
       }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
    </pre>

    <p>Alternatively, instead of processing metrics at a predefined time, or having to periodically poll the timeline for new metrics, the developer may also observe the <a>Performance Timeline</a> and be notified of new performance metrics via a <a>Performance Observer</a>:</p>

    <pre class="highlight example">&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;img id="image0" src="http://www.w3.org/Icons/w3c_main.png" /&gt;
    &lt;script&gt;
    var observer = new PerformanceObserver(function(list) {
      var doneObservingEvents = false;
      var perfEntries = list.getEntries();
      for (var i = 0; i &lt; perfEntries.length; i++)
      {
           if (window.console) console.log("Name: "        + perfEntries[i].name      +
                                           " Entry Type: " + perfEntries[i].entryType +
                                           " Start Time: " + perfEntries[i].startTime +
                                           " Duration: "   + perfEntries[i].duration  + "\n");
      }
      // maybe disconnect after processing the events.
      if (doneObservingEvents) {
           observer.disconnect();
      }
    });

    // subscribe to Frame-Timing and User-Timing events
    observer.observe({eventTypes: ['render', 'composite', 'mark', 'measure']});
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
  </section><section>
    <h2><dfn>Performance Timeline</dfn></h2>

    <p>The <a>Performance Timeline</a> enables the user agent and application developers to access, instrument, and retrieve various performance metrics from the full lifecycle of a web application.</p>

    <p>All interfaces that participate in the <a>Performance Timeline</a> MUST adhere to the following rules:</p>

    <ul>
      <li>MUST extend the <a>PerformanceEntry</a> interface</li>
      <li>MUST be supported by the <a href="#widl-Performance-getEntries-PerformanceEntryList">getEntries</a>, <a href="#widl-Performance-getEntriesByType-PerformanceEntryList">getEntriesByType</a>, and <a href="#widl-Performance-getEntriesByName-PerformanceEntryList">getEntriesByName</a> methods.</li>
      <li>SHOULD surface new performance metrics in a timely manner</li>
      <ul>
        <li>The user agent is NOT REQUIRED to provide synchronous access to new performance metrics</li>
        <li>The user agent MAY delay reporting the metric to avoid performance bottlenecks</li>
      </ul>
    </ul>

      <section>
        <h2>The <dfn>PerformanceEntry</dfn> interface</h2>
        <p>The <a>PerformanceEntry</a> interface hosts the performance data of various metrics.</p>

        <dl title="[Exposed=(Window,Worker)] interface PerformanceEntry" class="idl">
          <dt>readonly attribute DOMString name</dt>
          <dd>The attribute MUST return a <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> identifier for this <a>PerformanceEntry</a> object. This identifier does not have to be unique.</dd>
          <dt>readonly attribute DOMString entryType</dt>
          <dd>This attribute MUST return a <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> that describes the <a href="http://www.w3.org/wiki/Web_Performance/EntryType">type of the interface</a> represented by this <a>PerformanceEntry</a> object.</dd>
          <dt>readonly attribute DOMString startTime</dt>
          <dd>The attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a> that contains the time value of the first recorded timestamp of this performance metric.</dd>
          <dt>readonly attribute DOMString duration</dt>
          <dd>The attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a> that contains the time value of the duration of the entire event being recorded by this <a>PerformanceEntry</a>. Typically, this would be the time difference between the last recorded timestamp and the first recorded timestamp of this <a>PerformanceEntry</a>. If the duration concept doesn't apply, a performance metric may choose to return a `duration` of 0.</dd>
          <dt>serializer = { attribute }</dt>
        </dl>
      </section>

      <section>
        <h2>The <dfn>Performance</dfn> interface</h2>

        <p>The <a>Performance</a> interface hosts performance related attributes and methods used to retrieve the performance metric data from the <a>Performance Timeline</a>.</p>

        <dl title="[Exposed=(Window,Worker)] interface Performance : EventTarget" class="idl">
          <dt>PerformanceEntryList getEntries()</dt>
          <dd>This method returns a <a>PerformanceEntryList</a> object that contains a copy of all <a>PerformanceEntry</a> objects in chronological order with respect to <a href="#widl-PerformanceEntry-startTime">startTime</a>.</dd>

          <dt>PerformanceEntryList getEntriesByType(DOMString entryType)</dt>
          <dd>This method returns a <a>PerformanceEntryList</a> object that contains a copy of all <a>PerformanceEntry</a> objects, in chronological order with respect to <a href="#widl-PerformanceEntry-startTime">startTime</a>, that have the same value for the <a href="#widl-PerformanceEntry-entryType">entryType</a> attribute of <a>PerformanceEntry</a> as the <a href="#widl-PerformanceEntry-entryType">entryType</a> parameter. If no such <a>PerformanceEntry</a> objects exist, the <a>PerformanceEntryList</a> must be empty.</dd>

          <dt>PerformanceEntryList getEntriesByName(DOMString name, optional DOMString entryType)</dt>
          <dd>This method returns a <a>PerformanceEntryList</a> object that contains a copy of <a>PerformanceEntry</a> objects, in chronological order with respect to <a href="#widl-PerformanceEntry-startTime">startTime</a>, that have the same value for the <a href="#widl-PerformanceEntry-name">name</a> attribute of <a>PerformanceEntry</a> as the <a href="#widl-PerformanceEntry-name">name</a> parameter and, if specified, have the same value for the <a href="#widl-PerformanceEntry-entryType">entryType</a> attribute of <a>PerformanceEntry</a> as the <a href="#widl-PerformanceEntry-entryType">entryType</a> parameter. If no such <a>PerformanceEntry</a> objects exist, the <a>PerformanceEntryList</a> must be empty.</dd>
        </dl>

        <dl class="idl" title="typedef sequence<PerformanceEntry> PerformanceEntryList"></dl>

        <dl class="idl" title="[NoInterfaceObject, Exposed=(Window,Worker)] interface GlobalPerformance">
        <dt>[Replaceable] readonly attribute Performance performance</dt>
        <dd>
        <p>This attribute allows access to performance related attributes and methods.</p>
        </dd>
        </dl>
        <pre class="idl">        Window implements GlobalPerformance;
        WorkerGlobalScope implements GlobalPerformance;
        </pre>
      </section>

    <section>
      <h2>The <dfn>Performance Observer</dfn> interface</h2>

      <p>The <a>PerformanceObserver</a> interface can be used to observe the <a>Performance Timeline</a> and be notified of new performance entries as they are recorded by the user agent. A <dfn>registered performance observer</dfn> consists of an observer (a <a>PerformanceObserver</a> object) and options (a <a>PerformanceObserverInit</a> dictionary).</p>

      <dl title="callback PerformanceObserverCallback = void (PerformanceObserverEntryList entries, PerformanceObserver observer)" class="idl"></dl>

      <dl title="[Constructor(PerformanceObserverCallback callback), Exposed=(Window,Worker)] interface PerformanceObserver" class="idl">

        <dt>void observe(PerformanceObserverInit options)</dt>
        <dd>This method instructs the user agent to <dfn>register the observer</dfn> and report any new performance entries based on the criteria given by <a>options</a>.
          <dl title="dictionary PerformanceObserverInit" class="idl">
            <dt>sequence&lt;DOMString&gt; typeFilter</dt>
            <dd>
              <p>A list of valid <a href="#widl-PerformanceEntry-entryType">entryType names</a> to be observed. The list MUST NOT be empty and types not recognized by the user agent MUST be ignored.</p>

              <p class="note">To keep the performance overhead to minimum the application should only subscribe to event types that it is interested in, and disconnect the observer once it no longer needs to observe the performance data. Filtering by name is not supported, as it would implicitly require a subscription for all event types — this is possible, but discouraged, as it will generate a significant volume of events.</p>
            </dd>
          </dl>

          <p>The `observe(options)` method must run these steps:</p>
          <ol>
            <li>If _options'_ `typeFilter` attribute is not present, <a href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a JavaScript `TypeError`.</li>
            <li>Filter unsupported <a href="#widl-PerformanceEntry-entryType">entryType names</a> within the `typeFilter` sequence, and replace the `typeFilter` sequence with the new filtered sequence.</li>
            <li>If the _options'_ `typeFilter` attribute is an empty sequence, <a href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a JavaScript `TypeError`.</li>
            <li>Add a new <a>registered performance observer</a> with the <a href="http://www.w3.org/TR/dom/#context-object">context object</a> as the <dfn>observer</dfn> and _options_ as the `options`.</li>
          </ol>
        </dd>

        <dt>void disconnect()</dt>
        <dd>This method must remove the <a>registered performance observer</a> from the <a>Performance Timeline</a> for which the <a href="http://www.w3.org/TR/dom/#context-object">context object</a> is the <a>observer</a>.</dd>
      </dl>

      <section>
        <h2>The <dfn>PerformanceObserverEntryList</dfn> interface</h2>

        <p>The <a>PerformanceObserverEntryList</a> interface provides the same `getEntries`, `getEntriesByType`, `getEntriesByName` methods as the <a>Performance</a> interface, except that <a>PerformanceObserverEntryList</a> operates on the observed emitted list of events instead of the global timeline.</p>

        <dl title="[Exposed=(Window,Worker)] interface PerformanceObserverEntryList" class="idl">
          <dt>PerformanceEntryList getEntries()</dt>
          <dd>See <a href="#widl-Performance-getEntries-PerformanceEntryList">performance.getEntries</a>.</dd>
          <dt>PerformanceEntryList getEntriesByType(DOMString entryType)</dt>
          <dd>See <a href="#widl-Performance-getEntriesByType-PerformanceEntryList">performance.getEntriesByType</a>.</dd>
          <dt>PerformanceEntryList getEntriesByName(DOMString name, optional DOMString entryType)</dt>
          <dd>See <a href="#widl-Performance-getEntriesByName-PerformanceEntryList">performance.getEntriesByName</a>.</dd>
        </dl>
      </section>

    </section>
  </section><section>
    <h2>Vendor Extensions</h2>
    <p>If a vendor-specific proprietary user agent extension is needed to create experimental <a>PerformanceEntry</a> objects, on getting the <a href="#idl-PerformanceEntry-entryType">entryType</a> IDL attribute, vendors MUST return a `DOMString` that uses the following convention:</p>
    <pre>[vendorPrefix]-[entryType]</pre>
    <p>Where, `[vendorPrefix]` is a non-capitalized name that identifies the vendor, `[entryType]` is a non-capitalized name given to the type of   interface represented by this <a>PerformanceEntry</a> object, and the above names are in ASCII.</p>
  </section></section><section><h2>Resource Timing</h2>

<p>This specification defines an interface for web applications to access
the complete timing information for resources in a document.</p>
<section id='informative' class='informative'>
<h2>Introduction</h2>
<p>
User latency is an important quality benchmark for Web Applications. While
JavaScript-based mechanisms can provide comprehensive instrumentation for
user latency measurements within an application, in many cases, they are
unable to provide a complete end-to-end latency picture. While Navigation Timing 2 [[navigation-timing-2]] addresses
part of the problem by providing timing information associated with a
navigation, this document introduces the <a href="#resource-timing">ResourceTiming</a>
interface to allow JavaScript mechanisms to collect complete timing
information related to resources on a document.
</p>


<p>For example, the following JavaScript shows a simple attempt to
measure the time it takes to fetch a resource:</p>

<pre class="example highlight">&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body onload="loadResources()"&gt;
    &lt;script&gt;
        function loadResources()
        {
           var start = new Date().getTime();
           var image1 = new Image();
           var resourceTiming = function() {
               var now = new Date().getTime();
               var latency = now - start;
               alert("End to end resource fetch: " + latency);
           };

           image1.onload = resourceTiming;
           image1.src = 'http://www.w3.org/Icons/w3c_main.png';
        }
    &lt;/script&gt;
    &lt;img src="http://www.w3.org/Icons/w3c_home.png"&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>

<p>Though this script can measure the time it takes to fetch a resource,
it cannot break down the time spent in various phases. Further, the script
cannot easily measure the time it takes to fetch resources described in markup.</p>

<p>To address the need for complete information on user experience, this document
introduces the <a href="#performanceresourcetiming">PerformanceResourceTiming</a> interface.
This interface allows JavaScript mechanisms to provide complete client-side latency measurements within applications.
With this interface, the previous example can be modified to measure a user's
perceived load time of a resource.
</p>

<p>The following script calculates the amount of time it takes to fetch every resource in the
page, even those defined in markup. This example assumes
that this page is hosted on http://www.w3.org.
One could further measure the amount of time it takes in every phase of fetching a resource
with the <a href="#performanceresourcetiming">PerformanceResourceTiming</a> interface.
</p>
<pre class="example highlight">&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body onload="loadResources()"&gt;
    &lt;script&gt;
       function loadResources()
       {
          var image1 = new Image();
          image1.onload = resourceTiming;
          image1.src = 'http://www.w3.org/Icons/w3c_main.png';
       }

       function resourceTiming()
       {
           var resourceList = window.performance.getEntriesByType("resource");
           for (i = 0; i &lt; resourceList.length; i++)
           {
              if (resourceList[i].initiatorType == "img")
              {
                 alert("End to end resource fetch: "+ resourceList[i].responseEnd - resourceList[i].startTime);
              }
           }
       }
    &lt;/script&gt;
    &lt;img id="image0" src="http://www.w3.org/Icons/w3c_home.png"&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>

</section><section>

<p>Requirements phrased in the imperative as part of algorithms (such as
"strip any leading space characters" or "return false and abort these steps")
are to be interpreted with the meaning of the key word ("MUST", "SHOULD",
"MAY", etc) used in introducing the algorithm. </p>

<p>Some conformance requirements are phrased as requirements on attributes,
methods or objects. Such requirements are to be interpreted as requirements
on user agents. </p>

<p>Conformance requirements phrased as algorithms or specific steps may be
implemented in any manner, so long as the end result is equivalent. (In
particular, the algorithms defined in this specification are intended to be
easy to follow, and not intended to be performant.) </p>

    <p>The IDL fragments in this specification must be interpreted as
    required for <a href="http://www.w3.org/TR/WebIDL/#dfn-conforming-idl-fragment">conforming IDL fragments</a>, as described in the Web IDL
    specification. [[!WebIDL]]</p>
</section><section>
<h2>Terminology</h2>

<p>The construction "a <code title="">Foo</code> object", where <code title="">Foo</code> is actually an interface, is sometimes used instead of
the more accurate "an object implementing the interface <code title="">Foo</code>". </p>

<p>The term DOM is used to refer to the API set made available to scripts in
Web applications, and does not necessarily imply the existence of an actual
<code>Document</code> object or of any other <code>Node</code> objects as
defined in the DOM specification. [[DOM]]
</p>

<p>A DOM attribute is said to be <em>getting</em> when its value is being
retrieved (such as by author script), and is said to be <em>setting</em> when
a new value is assigned to it.</p>

<p>The term "JavaScript" is used to refer to ECMA262, rather than the
official term ECMAScript, since the term JavaScript is more widely known. [[ECMA-262]]
</p>

<p>
  Throughout this work, all time values are measured in milliseconds since the start of
  navigation of the document. For example, the start of navigation of the document
  occurs at time 0. The term <i>current time</i> refers to the number of milliseconds
  since the start of navigation of the document until the current moment in time.
  This definition of time is based on the High Resolution Time specification
  [[HR-TIME]] and is different
  from the definition of time used in the Navigation Timing specification
  [[NAVIGATION-TIMING]],
  where time is measured in milliseconds since midnight of January 1, 1970 (UTC).
</p>
</section><section>
<h2>Resource Timing</h2>


<section id="introduction-1" class="informative">
<h3>Introduction</h3>

<p>
    The <a href="#performanceresourcetiming">PerformanceResourceTiming</a>
    interface facilitates timing measurement of downloadable resources. For example, this interface is available for
    <a href="http://www.w3.org/TR/XMLHttpRequest/#interface-xmlhttprequest">XMLHttpRequest</a> objects [[XMLHttpRequest]], HTML
    elements [[HTML5]] such as
    <a href="http://www.w3.org/TR/html5/embedded-content-0.html#the-iframe-element">iframe</a>,
    <a href="http://www.w3.org/TR/html5/embedded-content-0.html#the-img-element">img</a>,
    <a href="http://www.w3.org/TR/html5/scripting-1.html#the-script-element">script</a>,
    <a href="http://www.w3.org/TR/html5/embedded-content-0.html#the-object-element">object</a>,
    <a href="http://www.w3.org/TR/html5/embedded-content-0.html#the-embed-element">embed</a>,
    and <a href="http://www.w3.org/TR/html5/document-metadata.html#the-link-element">link</a>
    with the link type of
    <a href="http://www.w3.org/TR/html5/links.html#link-type-stylesheet">stylesheet</a>,
    and SVG elements [[SVG11]] such
    as <a href="http://www.w3.org/TR/SVG11/struct.html#SVGElement">svg</a>.
</p>

<p>The term "resource" is used to refer to these elements and any other user-initiated fetches throughout this specification.</p>
</section>

<section id="resources-included">
<h3>Resources Included in the <code><a href="#performanceresourcetiming">PerformanceResourceTiming</a></code> Interface</h3>

<p>All resources <a title="fetch" href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetched</a> by the current <a href="http://www.w3.org/TR/html5/browsers.html#browsing-context">browsing</a> [[!HTML5]] or worker [[!WORKERS]] context's MUST be included as <a href="#performanceresourcetiming">PerformanceResourceTiming</a> objects in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a> of the relevant context. Resources that are retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant application caches</a> or local resources MUST be included as <a href="#performanceresourcetiming">PerformanceResourceTiming</a> objects in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a> ([[!performance-timeline]]). Resources for which the <a title="fetch" href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> was initiated, but was later aborted (e.g. due to a network error) MUST be included as <a href="#performanceresourcetiming">PerformanceResourceTiming</a> objects in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a> and MUST contain initialized attribute values for processed substeps of the <a href="#processing-model">processing model</a>.</p>

<p>The rest of this section is non-normative.</p>
<p>
    Examples:</p>
    <ul>
        <li>If the same canonical URL is used as the <code>src</code> attribute of two HTML <code>IMG</code> elements,
            the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource initiated by the first HTML <code>IMG</code> element SHOULD
			be included as a <a href="#performanceresourcetiming">PerformanceResourceTiming</a> object in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
			The user agent might not re-request the URL for the second HTML <code>IMG</code> element, instead using the existing download it initiated for the first HTML <code>IMG</code> element.
            In this case, the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource by the first
            <code>IMG</code> element would be the only occurrence in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
        </li>
        <li>If the <code>src</code> attribute of a HTML <code>IMG</code> element is changed via script, both the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the original resource as well
            as the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the new URL would be included as <a href="#performanceresourcetiming">PerformanceResourceTiming</a> objects in
			the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
        </li>
		<li>
			If an HTML <code>IFRAME</code> element is added via markup without specifying a <code>src</code> attribute, the user agent may load the <code>about:blank</code> document for the <code>IFRAME</code>. If at a later time the <code>src</code> attribute is changed dynamically via script, the user agent may
			<a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> the new URL resource for the <code>IFRAME</code>. In this case, only the
			<a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the new URL would be included
			as a <a href="#performanceresourcetiming">PerformanceResourceTiming</a> object in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
		</li>
        <li>
            If an <code>XMLHttpRequest</code> is generated twice for the same canonical URL, both <a title="fetch" href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetches</a> of the resource would be
            included as a <a href="#performanceresourcetiming">PerformanceResourceTiming</a> object in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
			This is because the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource for the second <code>XMLHttpRequest</code> cannot reuse the download issued for the first <code>XMLHttpRequest</code>.
        </li>
        <li>
            If an HTML <code>IFRAME</code> element is included on the page, then only the resource requested by <code>IFRAME</code> <code>src</code> attribute is included
            as a <a href="#performanceresourcetiming">PerformanceResourceTiming</a> object in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
			Sub-resources requested by the <code>IFRAME</code> document will be included in the <code>IFRAME</code> document's <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a> and not the parent
            document's <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
        </li>
        <li>
            If an HTML <code>IMG</code> element has a <code><a href="https://tools.ietf.org/html/rfc2397">data: URI</a></code> as its source [[!RFC2397]], then this resource will not
            be included as a <a href="#performanceresourcetiming">PerformanceResourceTiming</a> object in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
			By definition <code><a href="https://tools.ietf.org/html/rfc2397">data: URI</a></code> contains embedded data and does not require a <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a>.
        </li>
        <li>
          If a resource <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> was aborted due to a networking error (e.g. DNS, TCP, or TLS error), then the fetch would be included as a <a href="#performanceresourcetiming">PerformanceResourceTiming</a> object in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a> with initialized attribute values up to the point of failure - e.g. a TCP handshake error should report DNS timestamps for the request, and so on.
        </li>
        <li>
          If a resource <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> is aborted because it failed a fetch precondition (e.g. mixed content, CORS restriction, CSP policy, etc), then this resource will not be included as a <a href="#performanceresourcetiming">PerformanceResourceTiming</a> object in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
        </li>
    </ul>
<p>
    The user agent MAY choose to limit how many resources are included as
    <a href="#performanceresourcetiming">PerformanceResourceTiming</a> objects in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
	The recommended minimum number of <a href="#performanceresourcetiming">PerformanceResourceTiming</a> objects is 150, though this may be changed by the user agent.
    <a href="#widl-Performance-setResourceTimingBufferSize-void-unsigned-long-maxSize"><code>setResourceTimingBufferSize</code></a>
    can be called to request a change to this limit.
</p>
</section>

<section id="performanceresourcetiming">
<h3>The <code>PerformanceResourceTiming</code> Interface</h3>

<p>
The <a href="#performanceresourcetiming">PerformanceResourceTiming</a> interface participates in the
	<a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a> and extends the following attributes of the
<a href="http://www.w3.org/TR/performance-timeline/#performanceentry">PerformanceEntry</a> interface:</p>

<dl class="attributes">
<dt id="widl-PerformanceResourceTiming-name"><code>name</code></dt>
    <dd>
    	This attribute MUST return the <a href="http://www.w3.org/TR/html5/infrastructure.html#resolve-a-url">resolved URL</a> of the
    	requested resource. This attribute MUST NOT change even if the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> redirected to a different URL.
   	</dd>
<dt id="widl-PerformanceResourceTiming-entryType"><code>entryType</code></dt>
<dd>The <code id="entryType-attribute">entryType</code> attribute MUST return the DOMString "<code id="perf-resource">resource</code>".</dd>
<dt id="widl-PerformanceResourceTiming-startTime"><code>startTime</code></dt>
<dd>The <code id="startTime-attribute">startTime</code> attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a> [[!HR-TIME]]
  with the time immediately before the user agent starts to queue the resource for <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetching</a>.
       If there are HTTP redirects or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>
       when fetching the resource, and if all the redirects or equivalent are from the <a href="https://tools.ietf.org/html/rfc6454#section-5">same origin</a> as the current
       document or the <a href="#timing-allow-check">timing allow check</a> algorithm passes, this attribute MUST return the same value as <a href="#widl-PerformanceResourceTiming-redirectStart">redirectStart</a>.
     Otherwise, this attribute MUST return the same value as <a href="#widl-PerformanceResourceTiming-fetchStart">fetchStart</a>.</dd>
<dt id="widl-PerformanceResourceTiming-duration"><code>duration</code></dt>
<dd>The <code id="duration-attribute">duration</code> attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
  equal to the difference between <a href="#widl-PerformanceResourceTiming-responseEnd">responseEnd</a> and <a href="#startTime-attribute">startTime</a>, respectively.</dd>
</dl>

<dl title="[Exposed=(Window,Worker)] interface PerformanceResourceTiming : PerformanceEntry" class="idl">

<dt>readonly attribute DOMString initiatorType</dt>
<dd>
<p>If the initiator is an <code><a href="http://www.w3.org/TR/dom/#concept-element">element</a></code>, on getting, the <code><a href="#widl-PerformanceResourceTiming-initiatorType">initiatorType</a></code> attribute MUST return a DOMString with the same value as the <code><a href="http://www.w3.org/TR/dom/#concept-element-local-name">localName</a></code> of that
<code><a href="http://www.w3.org/TR/dom/#concept-element">element</a></code> [[!DOM]].</p>
<p>If the initiator is a CSS resource downloaded by the <code><a href="http://www.w3.org/TR/css-syntax-3/#consume-a-url-token">url()</a></code> syntax [[!CSS-SYNTAX-3]], such as <code>@import url()</code> or <code>background: url()</code>,
on getting, the <code><a href="#widl-PerformanceResourceTiming-initiatorType">initiatorType</a></code> attribute MUST return the DOMString <code>"css"</code>.</p>
<p>If the initiator is an XMLHttpRequest object [[!XMLHttpRequest]], on getting, the <code><a href="#widl-PerformanceResourceTiming-initiatorType">initiatorType</a></code> attribute MUST return the DOMString <code>"xmlhttprequest"</code>.</p>
</dd>

<dt>readonly attribute DOMString nextHopProtocol</dt>
<dd>
<p>This attribute MUST return the network protocol used to fetch the resource, as identified by the ALPN Protocol ID [[!RFC7301]]. When a proxy is configured, if a tunnel connection is established then this attribute MUST return the ALPN Protocol ID of the tunneled protocol, otherwise it MUST return the ALPN Protocol ID of the first hop to the proxy.</p>
<p>In order to have precisely one way to represent any ALPN protocol ID, the following additional constraints apply: octets in the ALPN protocol MUST NOT be percent-encoded if they are valid token characters except "%", and when using percent-encoding, uppercase hex digits MUST be used.</p>
<p>Note that this attribute is intended to identify the network protocol in use for the fetch regardless of how it was actually negotiated; that is, even if ALPN is not used to negotiate the network protocol, this attribute still uses the ALPN Protocol ID's to indicate the protocol in use.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp workerStart</dt>
<dd>If the current browsing or worker context's have an <a href="http://www.w3.org/TR/service-workers/#dfn-containing-service-worker-registration">active worker</a> ([[!SERVICE-WORKERS]]), this attribute MUST return the time immediately before the user agent <a href="http://www.w3.org/TR/service-workers/#service-worker-concept">runs the worker</a> required to service the request, or if the worker is available, the time immediately before the user agent <a href="http://www.w3.org/TR/service-workers/#on-fetch-request-algorithm">fires an event named `fetch`</a> at the <a href="http://www.w3.org/TR/service-workers/#dfn-active-worker">active worker</a>. Otherwise, if there is no active worker this attribute MUST return zero.</dd>

<dt>readonly attribute DOMHighResTimeStamp redirectStart</dt>
<dd>
<p>If there are HTTP redirects or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>
when <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetching</a> the resource and if all the redirects or equivalent are from the <a href="https://tools.ietf.org/html/rfc6454#section-5">same origin</a> as the current document,
this attribute MUST return the <a href="#widl-PerformanceResourceTiming-fetchStart">starting time</a> of the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> that initiates the redirect.</p>
<p>If there are HTTP redirects or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>
when <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetching</a> the resource and if any of the redirects are not from the <a href="https://tools.ietf.org/html/rfc6454#section-5">same origin</a> as the current document,
but the <a href="#timing-allow-check">timing allow check</a> algorithm passes for each redirected resource, this attribute MUST
return the <a href="#widl-PerformanceResourceTiming-fetchStart">starting time of the fetch</a> that initiates the redirect.
Otherwise, this attribute MUST return zero. </p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp redirectEnd</dt>
<dd>
<p>If there are HTTP redirects or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>
when <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetching</a> the resource and if all the redirects or equivalent are from the <a href="https://tools.ietf.org/html/rfc6454#section-5">same origin</a> as the current document,
this attribute MUST return the time immediately after receiving the last byte of the response of the last redirect.</p>

<p>If there are HTTP redirects or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>
when <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetching</a> the resource and if any of the redirects are not from the <a href="https://tools.ietf.org/html/rfc6454#section-5">same origin</a> as the current document,
but the <a href="#timing-allow-check">timing allow check</a> algorithm passes for each redirected resource, this attribute MUST return the
time immediately after receiving the last byte of the response of the last redirect.
Otherwise, this attribute MUST return zero. </p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp fetchStart</dt>
<dd>
<p>If there are no HTTP redirects or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>,
this attribute MUST return the time immediately before the user agent starts to <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> the resource.</p>
<p>If there are HTTP redirects or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>,
this attribute MUST return the time immediately before the user agent starts to <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> the final resource in the redirection.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domainLookupStart</dt>
<dd>
<p>This attribute MUST return the time immediately before the user agent starts
the domain name lookup for the resource.
If a <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent
connection</a> [[!RFC7230]] is used or the resource
is retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or local resources, this attribute MUST return the same
value as <a href="#widl-PerformanceResourceTiming-fetchStart">fetchStart</a>. </p>
<p>
If the last non-redirected <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource is not the same origin as the current document,
<a href="#widl-PerformanceResourceTiming-domainLookupStart">domainLookupStart</a> MUST return
zero unless the <a href="#timing-allow-check">timing allow check</a> algorithm passes.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domainLookupEnd</dt>
<dd>
<p>This attribute MUST return the time immediately after the user agent finishes
the domain name lookup for the resource.
If a <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent
connection</a> [[!RFC7230]] is used or the resource
is retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or local resources, this attribute MUST return the same
value as <a href="#widl-PerformanceResourceTiming-fetchStart">fetchStart</a>. </p>
<p>If the user agent has the domain information in cache,
domainLookupStart and domainLookupEnd represent the times when the user agent
starts and ends the domain data retrieval from the cache. </p>
<p>
If the last non-redirected <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource is not the same origin as the current document,
<a href="#widl-PerformanceResourceTiming-domainLookupEnd">domainLookupEnd</a> MUST return
zero unless the <a href="#timing-allow-check">timing allow check</a> algorithm passes.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp connectStart</dt>
<dd>
<p>This attribute MUST return the time immediately before the user agent start
establishing the connection to the server to retrieve the resource.
If a <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent
connection</a> [[!RFC7230]] is used or the resource is retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or local resources, this attribute MUST return value of
<a href="#widl-PerformanceResourceTiming-domainLookupEnd">domainLookupEnd</a>.</p>

<p>
If the last non-redirected <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource is not the same origin as the current document,
<a href="#widl-PerformanceResourceTiming-connectStart">connectStart</a> MUST return
zero unless <a href="#timing-allow-check">timing allow check</a> algorithm passes.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp connectEnd</dt>
<dd>
<p>This attribute MUST return the time immediately after the user agent finishes
establishing the connection to the server to retrieve the resource.
If a <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent
connection</a> [[!RFC7230]] is used or the resource is retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or local resources, this attribute MUST return the value of
<a href="#widl-PerformanceResourceTiming-domainLookupEnd">domainLookupEnd</a>.</p>
<p>If the transport connection fails and the user agent reopens a connection,
<a href="#widl-PerformanceResourceTiming-connectStart">connectStart</a> and <a href="#widl-PerformanceResourceTiming-connectEnd">connectEnd</a> SHOULD return the corresponding
values of the new connection. </p>
<p><a href="#widl-PerformanceResourceTiming-connectEnd">connectEnd</a> MUST include the time interval to
establish the transport connection, as well as other time intervals such as SSL handshake and SOCKS authentication. </p>
<p>
If the last non-redirected <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource is not the same origin as the current document,
<a href="#widl-PerformanceResourceTiming-connectEnd">connectEnd</a> MUST return
zero unless the <a href="#timing-allow-check">timing allow check</a> algorithm passes.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp secureConnectionStart</dt>
<dd>
<p>When a secure transport is used, this attribute MUST return the
time immediately before the user agent starts the handshake process to secure the current connection. If a secure transport is not used, this attribute MUST return zero.</p>
<p>
If the last non-redirected <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource is not the same origin as the current document,
<a href="#widl-PerformanceResourceTiming-secureConnectionStart">secureConnectionStart</a> MUST return
zero unless the <a href="#timing-allow-check">timing allow check</a> algorithm passes.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp requestStart</dt>
<dd>
<p>This attribute MUST return the time immediately before the user agent
starts requesting the resource from the server, or from
<a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">
relevant application caches</a> or from local resources.</p>
<p>If the transport connection fails after a request is sent and the user
agent reopens a connection and resend the request, <a href="#widl-PerformanceResourceTiming-requestStart">requestStart</a> MUST return the corresponding values
of the new request.</p>
<p>
If the last non-redirected <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource is not the same origin as the current document,
<a href="#widl-PerformanceResourceTiming-requestStart">requestStart</a> MUST return
zero unless the <a href="#timing-allow-check">timing allow check</a> algorithm passes.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp responseStart</dt>
<dd>
<p>This attribute MUST return the time immediately after the user agent receives
the first byte of the response from the server, or from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or from local resources.</p>
<p>
If the last non-redirected <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource is not the same origin as the current document,
<a href="#widl-PerformanceResourceTiming-responseStart">responseStart</a> MUST return
zero unless the <a href="#timing-allow-check">timing allow check</a> algorithm passes.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp responseEnd</dt>
<dd>
<p>This attribute MUST return the time immediately after the user agent finishes
receiving the last byte of the resource from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or from local resources.</p>
</dd>

<dt>readonly attribute unsigned short transferSize</dt>
<dd>
<p>This attribute MUST return the size, in octets received by the client, consumed by the response header fields and the response <a href="http://httpwg.github.io/specs/rfc7230.html#message.body">payload body</a> [[!RFC7230]].</p>
<p>This attribute SHOULD include HTTP overhead (such as HTTP/1.1 chunked encoding and whitespace around header fields, including newlines, and <a href="https://tools.ietf.org/html/draft-ietf-httpbis-http2-16">HTTP/2</a> frame overhead, along with other server-to-client frames on the same stream), but SHOULD NOT include lower-layer protocol overhead (such as TLS or TCP). If there are HTTP redirects or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a> when navigating and if all the redirects or equivalent are from the same <a href="https://tools.ietf.org/html/rfc6454#section-4">origin</a> [[!RFC6454]], this attribute SHOULD include the HTTP overhead of incurred redirects.</p>
</dd>

<dt>readonly attribute unsigned short encodedBodySize</dt>
<dd>
<p>This attribute MUST return the size, in octets received by the client, of the <a href="http://httpwg.github.io/specs/rfc7230.html#message.body">payload body</a> [[!RFC7230]], prior to removing any applied <a href="http://httpwg.github.io/specs/rfc7231.html#data.encoding">content-codings</a> [[!RFC7231]].</p>
</dd>

<dt>readonly attribute unsigned short decodedBodySize</dt>
<dd>
<p>This attribute MUST return the size, in octets received by the client, of the <a href="http://httpwg.github.io/specs/rfc7230.html#message.body">message body</a> [[!RFC7230]], after removing any applied <a href="http://httpwg.github.io/specs/rfc7231.html#data.encoding">content-codings</a> [[!RFC7231]].</p>
</dd>

<dt>serializer = { inherit, attribute }</dt>


</dl>

</section>

<section id="extensions-performance-interface">
<h3>Extensions to the <code>Performance</code> Interface</h3>

<dl class="idl" title="partial interface Performance">

<dt>void clearResourceTimings()</dt>
<dd>
	<p>The method <code>clearResourceTimings</code> clears the buffer used to store the current
    list of <a href="#performanceresourcetiming">PerformanceResourceTiming</a> resources.
    </p>
</dd>


<dt>void setResourceTimingBufferSize(unsigned long maxSize)</dt>
<dd>
<p>The <code>setResourceTimingBufferSize</code> method, when invoked, MUST set the maximum number of <a href="#performanceresourcetiming">PerformanceResourceTiming</a> resources that may be stored in
	the buffer to the value of the maxSize parameter. The buffer is considered to be full if the number of entries in it is greater than or equal to <code>maxSize</code>.</p>
<p>If this method is not called, the user agent SHOULD store at least 150 <a href="#performanceresourcetiming">PerformanceResourceTiming</a> resources in the buffer, unless otherwise specified by the user agent.</p>
<p>If the <code>maxSize</code> parameter is less than the number of elements currently stored in the buffer, no elements in the buffer are to be removed and the user agent MUST NOT fire the <code>resourcetimingbufferfull</code> event.</p>
		<dl class="parameters">
			<dt>unsigned long maxSize</dt>
			<dd>
      <p>The maxSize parameter sets the maximum number of <a href="#performanceresourcetiming">PerformanceResourceTiming</a> resources that will be stored in the buffer.</p>
			</dd>
    </dl>
</dd>
<dt>attribute EventHandler onresourcetimingbufferfull</dt>
<dd>
<p>
    The event handler for the <code>resourcetimingbufferfull</code> event. Immediately after the buffer used to store the list of <a href="#performanceresourcetiming">PerformanceResourceTiming</a>
    resources becomes full, the User Agent MUST fire a simple event named <code>resourcetimingbufferfull</code> that bubbles, isn't cancelable, has no default action, at the
    <a href="http://www.w3.org/TR/navigation-timing-2/#performance">Performance</a> object.
  </p>
</dd>
</dl>

</section>
<section id="cross-origin-resources">
<h3>Cross-origin Resources</h3>
    <p>
        Cross-origin resources MUST be included as <a href="#performanceresourcetiming">PerformanceResourceTiming</a> objects in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>.
		If the <a href="#timing-allow-check">timing allow check</a> algorithm fails for a cross-origin resource, these attributes of its <a href="#performanceresourcetiming">PerformanceResourceTiming</a> object
		MUST be set to zero: <a href="#widl-PerformanceResourceTiming-redirectStart">redirectStart</a>, <a href="#widl-PerformanceResourceTiming-redirectEnd">redirectEnd</a>,
        <a href="#widl-PerformanceResourceTiming-domainLookupStart">domainLookupStart</a>, <a href="#widl-PerformanceResourceTiming-domainLookupEnd">domainLookupEnd</a>, <a href="#widl-PerformanceResourceTiming-connectStart">connectStart</a>,
        <a href="#widl-PerformanceResourceTiming-connectEnd">connectEnd</a>, <a href="#widl-PerformanceResourceTiming-requestStart">requestStart</a>, <a href="#widl-PerformanceResourceTiming-responseStart">responseStart</a>
		and <a href="#widl-PerformanceResourceTiming-secureConnectionStart">secureConnectionStart</a>.
    </p>
    <p>
        The term <dfn id="cross-origin">cross-origin</dfn> is used to mean non
        <a href="https://tools.ietf.org/html/rfc6454#section-5">same origin</a>.
    </p>
    <p>
        Server-side applications may return the <code><a href="#timing-allow-origin">Timing-Allow-Origin</a></code> HTTP response header
        to allow the User Agent to fully expose, to the document origin(s) specified, the
        values of attributes that would have been zero due to the cross-origin
        restrictions previously specified in this section. </p>

    <section id="timing-allow-origin">
    <h4><code>Timing-Allow-Origin</code> Response Header</h4>
    <dl class="attributes">
      <dt id="http-timing-allow-origin"><code>Timing-Allow-Origin</code></dt>
      <dd>
        <p>The <dfn></dfn> header indicates whether a resource's timing can be
            shared based by returning the value of the Origin request header in the
            response.</p>
        <p>ABNF:</p>
        <pre>Timing-Allow-Origin = "Timing-Allow-Origin" ":" <a href="https://tools.ietf.org/html/rfc6454#section-7.1">origin-list-or-null</a> | "*"</pre>
        </dd>
    </dl>

	  <p>The <dfn id="timing-allow-check">timing allow check</dfn>
	  algorithm, which checks whether a cross-origin resource's timing information can be shared with the current document, is as follows:</p><p>

	  </p><ol>

	   <li><p>If the HTTP response includes zero or more than one
	   <code><a href="#http-timing-allow-origin">Timing-Allow-Origin</a></code>
	   header values, return fail and terminate this algorithm.</p></li>

	   <li><p>If the
	   <code><a href="#http-timing-allow-origin">Timing-Allow-Origin</a></code>
	   header value is the "<code>*</code>" character, return pass and terminate this
	   algorithm.</p></li>

	   <li><p>If the value of
	   <code><a href="#http-timing-allow-origin">Timing-Allow-Origin</a></code>
	   is not a <a href="http://www.w3.org/TR/html5/infrastructure.html#case-sensitive">case-sensitive</a> match for the value of the
	   <code title="http-origin"><a href="https://tools.ietf.org/html/rfc6454#section-4">origin</a></code> of the current document, return fail and terminate this algorithm.</p></li>

	   <li><p>Return pass.</p></li>
	   </ol>

	  <p class="note">The above algorithm also functions when the
	  <a href="https://tools.ietf.org/html/rfc6454#section-6.2">ASCII serialization of an origin</a> is
	  the string "<code>null</code>". Typically, this is the case when there are multiple redirects and the initiator is an XMLHttpRequest object.</p>

	  <p class="note">In practice the
	  <code><a href="https://tools.ietf.org/html/rfc6454#section-7.1">origin-list-or-null</a></code> production is
	  more constrained. Rather than allowing a space-separated list of
	  <a href="https://tools.ietf.org/html/rfc6454#section-4" title="origin">origins</a>, it is either a
	  single <a href="https://tools.ietf.org/html/rfc6454#section-4">origin</a> or the string
	  "<code>null</code>".</p>
    </section>
</section>

<section id="vendor-prefixes">
<h3>Vendor Prefixes</h3>

<p>Vendor-specific proprietary user agent extensions are discouraged.
If such extensions are needed, e.g., for experimental purposes, vendors MUST use the following extension mechanisms:</p>

<p>If an extension to the <a href="#widl-PerformanceResourceTiming-initiatorType">initiatorType</a> IDL attribute return value
 is needed for an experimental initiator type, on getting the <a href="#widl-PerformanceResourceTiming-initiatorType">initiatorType</a> IDL attribute,
  vendors MUST return a DOMString that uses the following convention:</p>

<p><code>[vendorprefix]-[name]</code></p>

<p>Where,</p>
<ul>
	<li><code>[vendorprefix]</code> is a non-capitalized name that identifies the vendor,</li>
	<li><code>[name]</code> is a non-capitalized name given to the initiator type,</li>
    <li>and the above names are in ASCII.</li>
</ul>

<p>If the extension is a new timing attribute, it MUST:</p>
<ul>
    <li>Follow this naming convention: [vendorPrefix]TimeName, where [vendorPrefix] is a
        name that identifies the vendor and TimeName identifies the name given to the
        timing attribute. </li>
    <li>Use a monotonically increasing clock, as defined in <a href="#monotonic-clock"></a>.</li>
    <li>Return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>.</li>
</ul>
</section>
</section><section>
<h2>Process</h2>

<section id="processing-model">
<h3>Processing Model</h3>

<p>The following graph illustrates the timing attributes defined by the PerformanceResourceTiming interface. Attributes underlined may not be available when <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetching</a> resources from different <a href="#same-origin">origins</a>. User agents may perform internal processing in between timings, which allow for non-normative intervals between timings.</p>

<p><img style="width:85%" src="resource-timing-overview-1.png" alt="Resource Timing attributes"></p>

<ol>
  <li>Once the <a href="http://www.w3.org/TR/workers/#processing-model">Worker</a> or <a href="http://www.w3.org/TR/html5/browsers.html#create-a-document-object">Window object</a> is created, the user agent MUST create a <a href="http://www.w3.org/TR/performance-timeline/#performanceentrylist">PerformanceEntryList</a>
  <i>primary buffer</i> object to store the list
  of <a href="#performanceresourcetiming">PerformanceResourceTiming</a> resources.</li>
  <li>Set the <i>primary buffer</i> to a size of 150, unless otherwise specified
  by the user agent or set by the <a href="#widl-Performance-setResourceTimingBufferSize-void-unsigned-long-maxSize"><code>setResourceTimingBufferSize</code></a> method.
  </li>
  <li>For each resource <a title="fetch" href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetched</a> by the current <a href="http://www.w3.org/TR/html5/browsers.html#browsing-context">browsing context</a>, perform the following steps:
  <ol>
      <li id="step-create-object">Create a new <a href="#performanceresourcetiming">PerformanceResourceTiming</a> object and
      set <a href="#entryType-attribute">entryType</a> to the DOMString <code>resource</code>.
      </li>
      <li>Immediately before the user agent starts to queue the resource for retrieval,
       record the current time in <a href="#startTime-attribute">startTime</a>, and set <a href="#widl-PerformanceResourceTiming-nextHopProtocol">nextHopProtocol</a> to the empty DOMString.
      </li>
      <li>Record the initiator of the resource in <a href="#widl-PerformanceResourceTiming-initiatorType">initiatorType</a>.
      </li>

      <li>Record the <a href="http://www.w3.org/TR/html5/infrastructure.html#resolve-a-url">resolved URL</a> of the requested resource in <a href="#widl-PerformanceResourceTiming-name">name</a>. If there is an <a href="http://www.w3.org/TR/service-workers/#dfn-containing-service-worker-registration">active worker</a> ([[!SERVICE-WORKERS]]) matching the current browsing or worker context's, immediately before the user agent <a href="http://www.w3.org/TR/service-workers/#service-worker-concept">runs the worker</a> record the time as <a href="#widl-PerformanceResourceTiming-workerStart">workerStart</a>, or if the worker is already available, immediately before the <a href="http://www.w3.org/TR/service-workers/#on-fetch-request-algorithm">event named `fetch` is fired</a> at the active worker record the time as <a href="#widl-PerformanceResourceTiming-workerStart">workerStart</a>. Otherwise, if there is no matching <a href="http://www.w3.org/TR/service-workers/#dfn-service-worker-registration">service worker registration</a>, set <a href="#widl-PerformanceResourceTiming-workerStart">workerStart</a> value to zero.</li>

      <li id="step-fetch-start">Immediately before a user agent starts the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetching process</a>, record the current time as <a href="#widl-PerformanceResourceTiming-fetchStart">fetchStart</a>. Let <a href="#widl-PerformanceResourceTiming-domainLookupStart">domainLookupStart</a>, <a href="#widl-PerformanceResourceTiming-domainLookupEnd">domainLookupEnd</a>, <a href="#widl-PerformanceResourceTiming-connectStart">connectStart</a> and <a href="#widl-PerformanceResourceTiming-connectEnd">connectEnd</a> be the same value as <a href="#widl-PerformanceResourceTiming-fetchStart">fetchStart</a>.</li>

      <li id="step-collection-start">If the user agent is to reuse the data from another existing or completed <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> initiated from the current document, abort the
          remaining steps.
      </li>
      <li>If <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetching</a> the resource is aborted for any reason, abort the remaining steps.       </li>
      <li>If the last non-redirected <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> of the resource is not the same origin as the current document
      and the <a href="#timing-allow-check">timing allow check</a> algorithm fails, the user agent
      MUST set
      <a href="#widl-PerformanceResourceTiming-redirectStart">redirectStart</a>,
      <a href="#widl-PerformanceResourceTiming-redirectEnd">redirectEnd</a>,
      <a href="#widl-PerformanceResourceTiming-domainLookupStart">domainLookupStart</a>,
      <a href="#widl-PerformanceResourceTiming-domainLookupEnd">domainLookupEnd</a>,
      <a href="#widl-PerformanceResourceTiming-connectStart">connectStart</a>,
      <a href="#widl-PerformanceResourceTiming-connectEnd">connectEnd</a>,
      <a href="#widl-PerformanceResourceTiming-requestStart">requestStart</a>,
      <a href="#widl-PerformanceResourceTiming-responseStart">responseStart</a> and
	  <a href="#widl-PerformanceResourceTiming-secureConnectionStart">secureConnectionStart</a>
	  to zero and go to step <a href="#step-response-end">3.17</a>.
      </li>
        <li>Let <a href="#widl-PerformanceResourceTiming-domainLookupStart">domainLookupStart</a>,
       <a href="#widl-PerformanceResourceTiming-domainLookupEnd">domainLookupEnd</a>,
       <a href="#widl-PerformanceResourceTiming-connectStart">connectStart</a> and
       <a href="#widl-PerformanceResourceTiming-connectEnd">connectEnd</a> be the same value as
       <a href="#widl-PerformanceResourceTiming-fetchStart">fetchStart</a>.</li>
      <li>If the resource is fetched from the <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache">
       relevant application cache</a> or local resources, including the <a href="https://tools.ietf.org/html/rfc7234">HTTP cache</a> [[!RFC7234]],
     go to step <a href="#step-request-start">3.15</a>.
      </li>
      <li>If no domain lookup is required, go to step <a href="#step-connect-start">3.13</a>. Otherwise, immediately before a user agent
       starts the domain name lookup, record the time as <a href="#widl-PerformanceResourceTiming-domainLookupStart">domainLookupStart</a>.</li>
      <li>Record the time as <a href="#widl-PerformanceResourceTiming-domainLookupEnd">domainLookupEnd</a> immediately after the
       domain name lookup is successfully done. A user agent may need multiple retries before that. If
       the domain lookup fails, abort the remaining steps. </li>
      <li id="step-connect-start">If a persistent transport connection is used to <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> the resource,
       let <a href="#widl-PerformanceResourceTiming-connectStart">connectStart</a> and <a href="#widl-PerformanceResourceTiming-connectEnd">connectEnd</a>
       be the same value of <a href="#widl-PerformanceResourceTiming-domainLookupEnd">domainLookupEnd</a>. Otherwise, record the time as
       <a href="#widl-PerformanceResourceTiming-connectStart">connectStart</a> immediately before initiating the connection to the server and record the time as <a href="#widl-PerformanceResourceTiming-connectEnd">connectEnd</a> immediately after the connection to the server or the proxy is established. A user agent may need multiple retries before this time. Once connection is established set the value of <a href="#widl-PerformanceResourceTiming-nextHopProtocol">nextHopProtocol</a> to the ALPN ID used by the connection. If a connection can not be established, abort the remaining steps.
      </li>
      <li>The user agent MUST set the <a href="#widl-PerformanceResourceTiming-secureConnectionStart">secureConnectionStart</a> attribute as follows:
        <ol>
        <li>When a secure transport is used, the user agent MUST record the
         time as <a href="#widl-PerformanceResourceTiming-secureConnectionStart">secureConnectionStart</a>
         immediately before the handshake process to secure the connection.
        </li>
        <li>When a secure transport is not used, the user agent MUST set the
        value of <a href="#widl-PerformanceResourceTiming-secureConnectionStart">secureConnectionStart</a> to 0.
        </li>
        </ol>
      </li>
      <li id="step-request-start">Immediately before a user agent starts sending the request
      for the resource, record the current time as <a href="#widl-PerformanceResourceTiming-requestStart">requestStart</a>.
      </li>
      <li id="step-response-start">Record the time as <a href="#widl-PerformanceResourceTiming-responseStart">
      responseStart</a> immediately after the user agent receives the first byte of the response.
      </li>
      <li id="step-response-end">Record the time as <a href="#widl-PerformanceResourceTiming-responseEnd">responseEnd</a>
      immediately after receiving the last byte of the response.
      <ol>
        <li>Return to step <a href="#step-connect-start">3.13</a> if the user agent fails to send the request or receive the entire response, and needs to reopen the connection.

        <div class="example">
        <div class="example-title">EXAMPLE</div>
        <p>When <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent connection</a>
        [[!RFC7230]] is enabled, a user agent may first try to re-use an open connect to
        send the request while the connection can be <a href="https://tools.ietf.org/html/rfc7230#section-6.5">asynchronously
        closed</a>. In such case, <a href="#widl-PerformanceResourceTiming-connectStart">connectStart</a>, <a href="#widl-PerformanceResourceTiming-connectEnd">connectEnd</a> and
        <a href="#widl-PerformanceResourceTiming-requestStart">requestStart</a> SHOULD represent timing information collected over the re-open connection. </p>
        </div></li>

        <li>Set the value of <a href="#widl-PerformanceResourceTiming-transferSize">transferSize</a>, <a href="#widl-PerformanceResourceTiming-encodedBodySize">encodedBodySize</a>, <a href="#widl-PerformanceResourceTiming-decodedBodySize">decodedBodySize</a> to corresponding values.</li>
      </ol>
      </li>
      <li>Record the difference between <a href="#widl-PerformanceResourceTiming-responseEnd">responseEnd</a> and <a href="#startTime-attribute">startTime</a> in <a href="#duration-attribute">duration</a>.</li>
      <li>If the fetched resource results in an HTTP redirect or
      <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>, then
      <ol style="list-style-type:lower-alpha;">
            <li>If the current resource and the redirected resource are not from the
             <a href="https://tools.ietf.org/html/rfc6454#section-5">same origin</a> as the current document,
			 and the <a href="#timing-allow-check">timing allow check</a> algorithm fails for either resource,
			 set <a href="#widl-PerformanceResourceTiming-redirectStart">
             redirectStart</a> and <a href="#widl-PerformanceResourceTiming-redirectEnd">redirectEnd</a> to 0. Then, return to step <a href="#step-fetch-start">
             3.5</a> with the new resource.
	        </li>
            <li>If the value of redirectStart is not set, let it be the value of fetchStart.
            </li>
            <li>Let redirectEnd be the value of responseEnd.
            </li>
            <li>Set all the attributes in the <a href="#performanceresourcetiming">
             PerformanceResourceTiming</a> object to 0 except
             <a href="#startTime-attribute">startTime</a>,
             <a href="#widl-PerformanceResourceTiming-redirectStart">redirectStart</a>, <a href="#widl-PerformanceResourceTiming-redirectEnd">
             redirectEnd</a>, and <a href="#widl-PerformanceResourceTiming-initiatorType">initiatorType</a>.
            </li>
            <li>Return to step <a href="#step-fetch-start">3.5</a> with the new resource.
            </li>
        </ol>
      </li>
      <li>If the <i>primary buffer</i> is full, discard the <a href="#performanceresourcetiming">PerformanceResourceTiming</a> object,
      created in step <a href="#step-create-object">3.1</a>. Otherwise, add it to the <i>primary buffer</i>.
	  If adding it causes the <i> primary buffer </i> to become full, fire the <a href="#widl-Performance-onresourcetimingbufferfull"><code>resourcetimingbufferfull</code></a> event at the Document.
      <ol>
            <li>
            If the <a href="#widl-Performance-clearResourceTimings-void"><code>clearResourceTimings</code></a> method is called in the event handler for the <a href="#widl-Performance-onresourcetimingbufferfull"><code>resourcetimingbufferfull</code></a> event,
            clear all <a href="#performanceresourcetiming">PerformanceResourceTiming</a> objects in the <i>primary buffer</i>.
            </li>
            <li>
            If the <a href="#widl-Performance-setResourceTimingBufferSize-void-unsigned-long-maxSize"><code>setResourceTimingBufferSize</code></a> method is called in the event handler for the <a href="#widl-Performance-onresourcetimingbufferfull"><code>resourcetimingbufferfull</code></a> event,
            set the maximum size of the <i>primary buffer</i> to the maxSize parameter. If the maxSize parameter is less than the number of elements currently stored in the buffer, no elements in the buffer are to be removed.
            </li>
        </ol>
      </li>
  </ol>
  </li>
</ol>
</section>
<section id="monotonic-clock">
<h3>Monotonic Clock</h3>
<p>The value of the timing attributes MUST monotonically increase to ensure timing attributes are not
skewed by adjustments to the system clock while <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetching</a> the resource. The difference between any two chronologically
recorded timing attributes MUST never be negative. For all resources, including subdocument resources, the user agent MUST
record the system clock at the beginning of the root document navigation and define subsequent timing attributes in
terms of a monotonic clock measuring time elapsed from the beginning of the navigation.
</p>
</section>
</section><section id='informative' class='informative'>
<h2>Privacy and Security</h2>

<p>The <a href="#performanceresourcetiming">PerformanceResourceTiming</a> interface exposes timing information for a resource to any web page or worker that has requested that resource. To limit the access to the <a href="#performanceresourcetiming">PerformanceResourceTiming</a> interface, the <a href="https://tools.ietf.org/html/rfc6454#section-5">same origin</a>
policy is enforced by default and certain attributes are set to zero, as described in <a href="#cross-origin-resources"></a>. Resource providers can
explicitly allow all timing information to be collected for a resource by
adding the <a href="#timing-allow-origin">Timing-Allow-Origin</a> HTTP response header, which specifies the
domains that are allowed to access the timing information. </p>

<p>
Statistical fingerprinting is a privacy concern where a malicious web site may determine whether a user has visited a third-party web site by measuring the timing of cache hits and misses of resources in the third-party web site. Though the <a href="#performanceresourcetiming">PerformanceResourceTiming</a> interface gives timing information for resources in a document, the <a href="#cross-origin-resources">cross-origin restrictions</a> prevent making this privacy concern any worse than it is today using the load event on resources to measure timing to determine cache hits and misses.
</p>
</section></section><section><h2>Navigation Timing 2</h2>
  <p>This specification defines an interface for web applications to access the complete timing information for navigation of a document.</p>
<section id='informative' class='informative'>
<h2>Introduction</h2>

<p>Accurately measuring performance characteristics of web applications is an important aspect of making web applications faster. While JavaScript-based mechanisms, such as the one described in [[JSMEASURE]], can provide comprehensive instrumentation for user latency measurements within an application, in many cases, they are unable to provide a complete or detailed end-to-end latency picture. For example, the following JavaScript shows a naive attempt to measure the time it takes to fully load a page:</p>

<pre class="example highlight">&lt;html&gt;
&lt;head&gt;
&lt;script type="text/javascript"&gt;
var start = new Date().getTime();
function onLoad() {
  var now = new Date().getTime();
  var latency = now - start;
  alert("page loading time: " + latency);
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body onload="onLoad()"&gt;
&lt;!- Main page body goes from here. --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>

<p>The above script calculates the time it takes to load the page <b>after</b> the first bit of JavaScript in the head is executed, but it does not give any information about the time it takes to get the page from the server, or the initialization lifecycle of the page.</p>

<p>This specification defines the <a>PerformanceNavigationTiming</a> interface which participates in the [[PERFORMANCE-TIMELINE]] to store and retrieve high resolution performance metric data related to the navigation of a document. As the <a>PerformanceNavigationTiming</a> interface uses [[HR-TIME]], all time values are measured from the start of the navigation. For example, if we know that the response end occurs 100ms after the start of navigation, we MAY find data that the <a>PerformanceNavigationTiming</a> data looks like so:</p>

<pre class="example highlight">startTime:           0.000  // start time of the navigation request
responseEnd:       100.000  // high resolution time of last received byte
</pre>

<p>The following script shows how a developer can use the <a>PerformanceNavigationTiming</a> interface to obtain accurate timing data related to the navigation of the document:</p>

<pre class="example highlight">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
&lt;body onload="init()"&gt;
&lt;script&gt;
function init() {
  var navigationTiming = performance.getEntriesByType("navigation")[0];
  if (window.console) {
    console.log("Name: "       + navigationTiming.name      + "\n" +
                "Entry Type: " + navigationTiming.entryType + "\n" +
                "Start Time: " + navigationTiming.startTime + "\n" +
                "Duration: "   + navigationTiming.duration  + "\n" +
                "Unload: "     + (navigationTiming.unloadEventEnd -
                                  navigationTiming.unloadEventStart)  + "\n" +
                "Redirect: "   + (navigationTiming.redirectEnd -
                                  navigationTiming.redirectStart)     + "\n" +
                "App Cache: "  + (navigationTiming.domainLookupStart -
                                  navigationTiming.fetchStart)        + "\n" +
                "DNS: "        + (navigationTiming.domainLookupEnd -
                                  navigationTiming.domainLookupStart) + "\n" +
                "TCP: "        + (navigationTiming.connectEnd -
                                  navigationTiming.connectStart)      + "\n" +
                "Request: "    + (navigationTiming.responseStart -
                                  navigationTiming.requestStart)      + "\n" +
                "Response: "   + (navigationTiming.responseEnd -
                                  navigationTiming.responseStart)     + "\n" +
                "Processing: " + (navigationTiming.loadEventStart -
                                  navigationTiming.responseEnd)       + "\n" +
                "Onload: "     + (navigationTiming.loadEventEnd -
                                  navigationTiming.loadEventStart)    + "\n");
  }
}
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</section><section>

<p>Requirements phrased in the imperative as part of algorithms (such as
"strip any leading space characters" or "return false and abort these steps")
are to be interpreted with the meaning of the key word ("MUST", "SHOULD",
"MAY", etc) used in introducing the algorithm. </p>

<p>Some conformance requirements are phrased as requirements on attributes,
methods or objects. Such requirements are to be interpreted as requirements
on user agents. </p>

<p>Conformance requirements phrased as algorithms or specific steps MAY be
implemented in any manner, so long as the end result is equivalent. (In
particular, the algorithms defined in this specification are intended to be
easy to follow, and not intended to be performant.) </p>

    <p>The IDL fragments in this specification must be interpreted as
    required for conforming IDL fragments, as described in the Web IDL
    specification. [[!WebIDL]]</p>
</section><section>
<h2>Terminology</h2>
  <p>The construction "a <code>Foo</code> object", where <code>Foo</code> is actually an interface, is sometimes used instead of the more accurate "an object implementing the interface <code>Foo</code>.</p>

  <p>The term "navigation" refers to the act of <a href="http://www.w3.org/TR/html5/browsers.html#navigate" title="navigation">navigating</a>.</p>

  <p>The term "JavaScript" is used to refer to ECMA262, rather than the
official term ECMAScript, since the term JavaScript is more widely known. [[ECMA-262]]</p>

  <p>Throughout this work, all time values are measured in milliseconds since the start of navigation of the document. For example, the start of navigation of the document occurs at time 0. The term <i>current time</i> refers to the number of milliseconds since the start of navigation of the document until the current moment in time. This definition of time is based on [[HR-TIME]] specification.</p>
</section><section>
<h2>Navigation Timing</h2>

<section id="sec-PerformanceNavigationTiming">
<h3>The <code>PerformanceNavigationTiming</code> interface</h3>

<p>The <a>PerformanceNavigationTiming</a> interface participates in the [[!PERFORMANCE-TIMELINE]] and extends the following attributes of the <a href="http://www.w3.org/TR/performance-timeline/#performanceentry">PerformanceEntry</a> interface:</p>

<dl class="attributes">
  <dt id="widl-PerformanceNavigationTiming-name"><code>name</code></dt>
  <dd>This attribute MUST return the <code>DOMString</code> "<code>document</code>".</dd>

  <dt id="widl-PerformanceNavigationTiming-entryType"><code>entryType</code></dt>
  <dd>This attribute MUST return the <code>DOMString</code> "<code id="perf-navigation">navigation</code>".</dd>

  <dt id="widl-PerformanceNavigationTiming-startTime"><code>startTime</code></dt>
  <dd>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a> with a time value of 0. [[!HR-TIME]]</dd>

  <dt id="widl-PerformanceNavigationTiming-duration"><code>duration</code></dt>
  <dd>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a> equal to the difference between <a href="#widl-PerformanceNavigationTiming-loadEventEnd">loadEventEnd</a> and <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a>, respectively.</dd>
</dl>

<dl title="interface PerformanceNavigationTiming : PerformanceEntry" class="idl">

<dt>readonly attribute DOMHighResTimeStamp unloadEventStart</dt>
<dd>
<p>If the previous document and the current document have the same
<a href="http://tools.ietf.org/html/rfc6454">origin</a>
[[!RFC6454]],
this attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent starts
the <a href="http://www.w3.org/TR/html5/browsers.html#unloading-documents">unload event</a> of the previous document.

If there is no previous document or the previous document has a
different <a href="http://tools.ietf.org/html/rfc6454">origin</a> than the
current document, this attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp unloadEventEnd</dt>
<dd>
<p>If the previous document and the current document have the
same <a href="http://tools.ietf.org/html/rfc6454">same origin</a>,
this attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after the user agent finishes the
<a href="http://www.w3.org/TR/html5/browsers.html#unloading-documents">unload event</a> of the previous document. If there is no previous document or the previous document has
a different <a href="http://tools.ietf.org/html/rfc6454">origin</a> than the
current document or the unload is not yet completed, this attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero.</p>

<p>If there are HTTP redirects or
<a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>
when navigating and not all the redirects or equivalent are from the
same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
both <a href="#widl-PerformanceNavigationTiming-unloadEventStart">unloadEventStart</a> and
<a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventEnd</a> MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp workerStart</dt>
<dd>If the current document has an <a href="http://www.w3.org/TR/service-workers/#dfn-containing-service-worker-registration">active service worker registration</a> ([[!SERVICE-WORKERS]]), this atribute MUST return the time immediately before the user agent <a href="http://www.w3.org/TR/service-workers/#service-worker-concept">ran the worker</a> required to service the request, or if the worker was already available, the time immediately before the user agent <a href="http://www.w3.org/TR/service-workers/#on-fetch-request-algorithm">fired an event named `fetch`</a> at the <a href="http://www.w3.org/TR/service-workers/#dfn-active-worker">active worker</a>. Otherwise, if there is no active worker this attribute MUST return zero.</dd>

<dt>readonly attribute DOMHighResTimeStamp linkNegotiationStart</dt>
<dd>
<p>This attribute is optional. User agents that don't have this attribute
available MUST set it as undefined. If the network interface is not immediately available and MUST be powered on, or cycled, before a network connection can be made, this attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
 with a time value equal to the time immediately before starting that process. If the network interface is immediately available, this attribute MUST return the same value as <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a>. </p>
</dd>
<dt>readonly attribute DOMHighResTimeStamp linkNegotiationEnd</dt>
<dd>
<p>This attribute is optional. User agents that don't have this attribute
available MUST set it as undefined.  If the network interface is not immediately available and MUST be powered on, or cycled, before a network connection can be made, this attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
 with a time value equal to the time immediately after the network interface becomes available. If the network interface is immediately available, this attribute MUST return the same value as <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a>. </p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp redirectStart</dt>
<dd>
<p>If there are HTTP redirects or
<a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>
when navigating and if all the redirects or equivalent are from the
same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
this attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the <a href="#widl-PerformanceNavigationTiming-fetchStart">starting time
of the fetch</a> that initiates the redirect. Otherwise, this attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp redirectEnd</dt>
<dd>
<p>If there are HTTP redirects
or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>
when navigating and all redirects and equivalents are from the
same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
this attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after receiving the last byte of
the response of the last redirect. Otherwise, this attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp fetchStart</dt>
<dd>
<p>If the new resource is to be
<a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetched</a> using HTTP GET or
<a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-get" title="HTTP GET method equivalence">equivalent</a>, fetchStart MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent starts
checking <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">
any relevant application caches</a>. Otherwise, it MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time when the user agent starts
<a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">fetching</a> the resource.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domainLookupStart</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent starts the domain name
lookup for the current document.
If a <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent
connection</a> [[!RFC7230]] is used or the current document
is retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or local resources,
this attribute MUST return the same value as <a href="#widl-PerformanceNavigationTiming-fetchStart">fetchStart</a>. </p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domainLookupEnd</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after the user agent
finishes the domain name lookup for the current document.
If a <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent
connection</a> [[!RFC7230]] is used or the current document
is retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or local resources,
this attribute MUST return the same value as <a href="#widl-PerformanceNavigationTiming-fetchStart">fetchStart</a>. </p>

<div class="note">
<p>Checking and retrieving contents from the
<a href="https://tools.ietf.org/html/rfc7234">HTTP cache</a> [[RFC7234]]
is part of the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">
fetching process</a>. It's covered by the
<a href="#widl-PerformanceNavigationTiming-requestStart">requestStart</a>,
<a href="#widl-PerformanceNavigationTiming-responseStart">responseStart</a> and
<a href="#widl-PerformanceNavigationTiming-responseEnd">responseEnd</a> attributes.</p>
</div>
<div class="note">
<p>In case where the user agent already has the domain information in cache,
domainLookupStart and domainLookupEnd represent the times when the user agent
starts and ends the domain data retrieval from the cache. </p>
</div>
</dd>

<dt>readonly attribute DOMHighResTimeStamp connectStart</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent start
establishing the connection to the server to retrieve the document.
If a <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent
connection</a> [[!RFC7230]] is used or the current document is retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or local resources,
this attribute MUST return value of <a href="#widl-PerformanceNavigationTiming-domainLookupEnd">domainLookupEnd</a>.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp connectEnd</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after the user agent
finishes establishing the connection to the server to retrieve the current document.
If a <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent
connection</a> [[!RFC7230]] is used or the current document is retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a>  [[!HTML5]] or local resources,
this attribute MUST return the value of <a href="#widl-PerformanceNavigationTiming-domainLookupEnd">domainLookupEnd</a>
</p>

<p>If the transport connection fails and the user agent reopens a connection,
<a title="#widl-PerformanceNavigationTiming-connectStart">connectStart</a> and
<a href="#widl-PerformanceNavigationTiming-connectEnd">connectEnd</a> SHOULD return the corresponding
values of the new connection. </p>
<p>
<a href="#widl-PerformanceNavigationTiming-connectEnd">connectEnd</a> MUST include the time interval to
establish the transport connection as well as other time interval
such as SSL handshake and SOCKS authentication.
</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp secureConnectionStart</dt>
<dd>
<p>
When a secure transport is used, this attribute MUST return the time immediately before the user agent starts the handshake process to secure the current connection. If a secure transport is not used, this attribute MUST return zero.
</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp requestStart</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent
starts requesting the current document from the server, or from
<a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant application caches</a> or from local resources.</p>

<p>If the transport connection fails after a request is sent and the user
agent reopens a connection and resend the request, <a href="#widl-PerformanceNavigationTiming-requestStart">requestStart</a> SHOULD return the corresponding values
of the new request.</p>

<div class="note">
<p>This interface does not include an attribute to represent the completion of
sending the request, e.g., requestEnd.</p>
<ul>
<li>Completion of sending the request from the user agent does not always
indicate the corresponding completion time in the network transport, which
brings most of the benefit of having such an attribute.</li>
<li>Some user agents have high cost to determine the actual completion time of
sending the request due to the HTTP layer encapsulation.</li>
</ul>
</div>
</dd>

<dt>readonly attribute DOMHighResTimeStamp responseStart</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after the user agent receives the first
byte of the response from the server, or from
<a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or from local resources. </p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp responseEnd</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after the user agent
receives the last byte of the current document or immediately before the
transport connection is closed, whichever comes first. The document here
can be received either from the server,
<a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
application caches</a> or from local resources.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domLoading</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent sets the
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
document readiness</a> to
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness" title="&quot;loading&quot; document readiness">"loading"</a> [[!HTML5]].</p>
  <p class="warning">The <code>domLoading</code> attribute is <strong>deprecated</strong> and may be removed in future versions of this specification. Due to differences in when a Document object is created in existing user agents, the value returned by the domLoading is implementation specific and should not be used in meaningful metrics.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domInteractive</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent sets the
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
document readiness</a> to
<a href="http://www.w3.org/TR/html5/syntax.html#the-end" title="&quot;interactive&quot; document readiness">"interactive"</a> [[!HTML5]].</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domContentLoadedEventStart</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent fires the <a href="http://www.w3.org/TR/html5/syntax.html#the-end">DOMContentLoaded
event</a> at the Document.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domContentLoadedEventEnd</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after the document's <a href="http://www.w3.org/TR/html5/syntax.html#the-end">DOMContentLoaded
event</a> completes.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domComplete</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent sets the
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
document readiness</a> to
<a href="http://www.w3.org/TR/html5/syntax.html#the-end" title="&quot;complete&quot; document readiness">"complete"</a> [[!HTML5]].</p>

<p>If the <a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">
current document readiness</a> changes to the same state multiple times,
<a href="#widl-PerformanceNavigationTiming-domLoading">domLoading</a>,
<a href="#widl-PerformanceNavigationTiming-domInteractive">domInteractive</a>,
<a href="#widl-PerformanceNavigationTiming-domContentLoadedEventStart">domContentLoadedEventStart</a>,
<a href="#widl-PerformanceNavigationTiming-domContentLoadedEventEnd">domContentLoadedEventEnd</a> and
<a href="#widl-PerformanceNavigationTiming-domComplete">domComplete</a> MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time of the first
occurrence of the corresponding
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness" title="current document readiness">document readiness</a>
change [[!HTML5]].</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp loadEventStart</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the load event of
the current document is fired. It MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero when the load event is not
fired yet.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp loadEventEnd</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time when the load event of the current
document is completed. It MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero when the load event is not fired
or is not completed.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp prerenderSwitch</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after the User Agent changes the <a href="http://www.w3.org/TR/page-visibility/#dom-document-visibilitystate">visibilityState</a>
from <code>prerender</code> to <code>visible</code> [[!Page-Visibility]]. If the document has not been <a href="http://microformats.org/wiki/rel-prerender" title="prerender">prerendered</a> by the User Agent [[prerender]], this attribute MUST return a
<a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a> with a time value equal to zero.
</p>
</dd>

<dt>readonly attribute NavigationType type</dt>
<dd>
<p>This attribute MUST return a <code>DOMString</code> describing the type of the last non-redirect <a href="http://www.w3.org/TR/html5/browsers.html#navigate">navigation</a>
in the current browsing context. It MUST have one of the <a>NavigationType</a> values. </p>

<div class="note">
<p>Client-side redirects, such as those using the <a href="http://www.w3.org/TR/html5/document-metadata.html#attr-meta-http-equiv-refresh">Refresh pragma directive</a>,
are not considered HTTP redirects or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a> by this spec.
In those cases, the <a href="#widl-PerformanceNavigationTiming-type">type</a> attribute SHOULD return appropriate value,
such as <a href="#idl-def-NavigationType.navigate">reload</a> if reloading the current page, or
<a href="#idl-def-NavigationType.navigate">navigate</a> if navigating to a new URL.</p>
</div>
</dd>

<dt>readonly attribute DOMString nextHopProtocol</dt>
<dd>
<p>This attribute MUST return the network protocol used to fetch the resource, as identified by the ALPN Protocol ID [[!RFC7301]]. When a proxy is configured, if a tunnel connection is established then this attribute MUST return the ALPN Protocol ID of the tunneled protocol, otherwise it MUST return the ALPN Protocol ID of the first hop to the proxy.</p>

<p>In order to have precisely one way to represent any ALPN protocol ID, the following additional constraints apply: octets in the ALPN protocol MUST NOT be percent-encoded if they are valid token characters except "%", and when using percent-encoding, uppercase hex digits MUST be used.</p>

<p>Note that this attribute is intended to identify the network protocol in use for the fetch regardless of how it was actually negotiated; that is, even if ALPN is not used to negotiate the network protocol, this attribute still uses the ALPN Protocol ID's to indicate the protocol in use.</p>
</dd>

<dt>readonly attribute unsigned short redirectCount</dt>
<dd>
<p>This attribute MUST return the number of redirects since the last
non-redirect navigation under the current browsing context. If there is no
redirect or there is any redirect that is not from the same
<a href="http://tools.ietf.org/html/rfc6454">
origin</a> [[!RFC6454]] as the destination document, this attribute MUST return zero. </p>
</dd>

<dt>readonly attribute unsigned short transferSize</dt>
<dd>
<p>This attribute MUST return the size, in octets received by the client, consumed by the response header fields and the response <a href="http://httpwg.github.io/specs/rfc7230.html#message.body">payload body</a> [[RFC7230]].</p>

<p>This attribute SHOULD include HTTP overhead (such as HTTP/1.1 chunked encoding and whitespace around header fields, including newlines, and HTTP/2 frame overhead, along with other server-to-client frames on the same stream), but SHOULD NOT include lower-layer protocol overhead (such as TLS or TCP). If there are HTTP redirects or
<a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>
when navigating and if all the redirects or equivalent are from the
same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
this attribute SHOULD include the HTTP overhead of incurred redirects.</p>
</dd>

<dt>readonly attribute unsigned short encodedBodySize</dt>
<dd>
<p>This attribute MUST return the size, in octets received by the client, of the <a href="http://httpwg.github.io/specs/rfc7230.html#message.body">payload body</a> [[RFC7230]], prior to removing any applied <a href="http://httpwg.github.io/specs/rfc7231.html#data.encoding">content-codings</a> [[!RFC7231]].
</p>
</dd>

<dt>readonly attribute unsigned short decodedBodySize</dt>
<dd>
<p>This attribute MUST return the size, in octets received by the client, of the <a href="http://httpwg.github.io/specs/rfc7230.html#message.body">message body</a> [[RFC7230]], after removing any applied <a href="http://httpwg.github.io/specs/rfc7231.html#data.encoding">content-codings</a> [[!RFC7231]].</p>
</dd>
<dt>serializer = { inherit, attribute }</dt>
</dl>

<section id="sec-performance-navigation-types">
<h4>Navigation types</h4>


<dl title="enum NavigationType" class="idl">
<dt>navigate</dt>
<dd>
<p>Navigation started by clicking on a link, or entering the URL in the user
agent's address bar, or form submission, or initializing through a script operation other than the ones used by <a href="#idl-def-NavigationType.navigate">reload</a> and <a href="#idl-def-NavigationType.back_forward">back_forward</a> as listed below.</p>
</dd>
<dt>reload</dt>
<dd>
<p>Navigation through the reload operation or the
    <a href="http://www.w3.org/TR/html5/browsers.html#dom-location-reload">location.reload()</a>
    method.</p>
    </dd>
<dt>back_forward</dt>
<dd>
<p>Navigation
  through a <a href="http://www.w3.org/TR/html5/browsers.html#traverse-the-history">history traversal</a> operation.</p>
  </dd>
<dt>prerender</dt>
<dd>
<p>Navigation initiated by a <a href="http://microformats.org/wiki/rel-prerender">prerender</a> hint.</p>
</dd>
</dl>

</section>

</section>
</section><section>
<h2>Process</h2>

<section id="processing-model">
<h3>Processing Model</h3>

<figure title="Timing attributes">
<figcaption>
This figure illustrates the timing attributes defined by the
<a>PerformanceNavigationTiming</a> interface. Attributes in parenthesis may not be
available in navigation involving documents from different
<a href="http://tools.ietf.org/html/rfc6454" title="origin">origins</a>. User
agents may perform internal processing in between timings, which allow for
non-normative intervals between timings.
</figcaption>
<svg xmlns="http://www.w3.org/2000/svg" width="942" height="501" style="display:block;margin:auto">
  <defs>
    <marker refX="0" refY="0" orient="auto" id="Arrow2Mend" style="overflow:visible">
      <path d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)" id="path4234" style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"></path>
    </marker>
  </defs>
  <style type="text/css">
   path { fill:none;stroke:#000080;stroke-width:1.5;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend); }
   rect { fill:#00ffff;fill-opacity:1;stroke:#0000ff;stroke-width:2; }
   text { font-size:12px;font-weight: bold;text-align:center;fill:#000000;fill-opacity:1;stroke:none;font-family:monospace; }
   .middle { text-anchor:middle; }
   .end { text-anchor:end; }
   .highlight { font-style: italic; }
  </style>
  <g transform="translate(-4.3,-477.125)">
    <rect width="80" height="80" x="10" y="702"></rect>
    <rect width="70" height="80" x="100" y="702"></rect>
    <rect width="59.999966" height="79.999962" x="880" y="702"></rect>
    <rect width="210" height="80" x="660" y="702"></rect>
    <rect width="90" height="80" x="560" y="702"></rect>
    <rect width="90" height="80" x="470" y="702"></rect>
    <rect width="60" height="80" x="400" y="702"></rect>
    <rect width="50" height="80" x="340" y="702"></rect>
    <rect width="60" height="80" x="270" y="702"></rect>
    <rect width="80" height="80" x="180" y="702"></rect>
    <rect width="160" height="50" x="690" y="762"></rect>
    <rect width="80" height="50" x="200" y="762"></rect>
    <text class="middle"><tspan x="50" y="729">Prompt</tspan><tspan x="50" y="747">for</tspan><tspan x="50" y="764">unload</tspan></text>
    <text class="middle"><tspan x="135.28711" y="738">Negotiate</tspan><tspan x="135" y="756">link</tspan></text>
    <text x="219.94189" y="747.12683" class="middle"><tspan>redirect</tspan></text>
    <text class="middle"><tspan x="299.95557" y="738">App</tspan><tspan x="300" y="755.7572">cache</tspan></text>
    <text x="365.25977" y="745" class="middle"><tspan>DNS</tspan></text>
    <text x="430.0376" y="745" class="middle"><tspan>TCP</tspan></text>
    <text x="514.8667" y="745" class="middle"><tspan>Request</tspan></text>
    <text x="605.0752" y="745" class="middle"><tspan>Response</tspan></text>
    <text x="765.01025" y="745" class="middle"><tspan>Processing</tspan></text>
    <text x="909.77441" y="745" class="middle"><tspan>load</tspan></text>
    <text x="769.86328" y="792" class="middle"><tspan>DOMContentLoaded</tspan></text>
    <text x="239.97607" y="792.12683" class="middle"><tspan>unload</tspan></text>
    <text x="490" y="512.12122"><tspan>(linkNegotiationStart)</tspan></text>
    <text x="490.49219" y="491.88022" class="highlight"><tspan>startTime</tspan></text>
    <text x="490" y="532"><tspan>(linkNegotiationEnd)</tspan></text>
    <text x="490" y="552.60315" class="highlight"><tspan>redirectStart</tspan></text>
    <text x="490" y="593.08502"><tspan>fetchStart</tspan></text>
    <text x="490" y="572.84412" class="highlight"><tspan>redirectEnd</tspan></text>
    <text x="490" y="613.32599"><tspan>domainLookupStart</tspan></text>
    <text x="490" y="633.56696"><tspan>domainLookupEnd</tspan></text>
    <text x="490" y="653.56866"><tspan>connectStart</tspan></text>
    <text x="490" y="674.04889"><tspan>secureConnectionStart</tspan></text>
    <text x="490" y="694.28986"><tspan>connectEnd</tspan></text>
    <text x="440.20801" y="812" class="end"><tspan>requestStart</tspan></text>
    <text x="440.20801" y="838.98895" class="end"><tspan>responseStart</tspan></text>
    <text x="440.20801" y="865.85504" class="end"><tspan>responseEnd</tspan></text>
    <text x="858.44238" y="952" class="end"><tspan>domComplete</tspan></text>
    <text x="852.79004" y="612" class="end"><tspan>loadEventEnd</tspan></text>
    <text x="852.79004" y="644.65131" class="end"><tspan>loadEventStart</tspan></text>
    <text x="439.83203" y="892.48181" class="end"><tspan>domLoading</tspan></text>
    <text x="439.83203" y="919.10858" class="end"><tspan>domInteractive</tspan></text>
    <text x="439.83203" y="945.73541" class="end"><tspan>domContentLoadedEventStart</tspan></text>
    <text x="439.83203" y="972" class="end"><tspan>domContentLoadedEventEnd</tspan></text>
    <path d="M 480,40 150,40 90,250" transform="translate(0,452)"></path>
    <text x="144.81705" y="846" class="end highlight"><tspan>unloadEventStart</tspan></text>
    <text x="143.46094" y="872" class="end highlight"><tspan>unloadEventEnd</tspan></text>
    <path d="m 480,512 -310,0 -70,190"></path>
    <path d="m 480,532 -280,0 -30,170"></path>
    <path d="m 480,552 -270,0 -30,150"></path>
    <path d="m 480,572 -200,0 -20,130"></path>
    <path d="m 480,592 -180,0 -30,110"></path>
    <path d="m 480,612 -110,0 -30,90"></path>
    <path d="m 480,632 -70,0 -20,70"></path>
    <path d="m 480,652 -50,0 -30,50"></path>
    <path d="m 480,672 -40,0 -20,30"></path>
    <path d="m 480,692 -10,0 -10,10"></path>
    <path d="m 450,812 10,0 10,-30"></path>
    <path d="m 450,832 50,0 60,-50"></path>
    <path d="m 450,862 100,0 100,-80"></path>
    <path d="m 450,892 140,0 80,-110"></path>
    <path d="m 450,922 150,0 80,-120"></path>
    <path d="m 450,942 190,0 50,-130"></path>
    <path d="m 450,972 220,0 180,-160"></path>
    <path d="m 870,952 50,0 -60,-160"></path>
    <path d="m 860,642 10,0 10,60"></path>
    <path d="m 860,612 40,0 40,90"></path>
    <path d="m 150,842 30,0 20,-30"></path>
    <path d="m 150,872 80,0 50,-60"></path>
  </g>
</svg>
</figure>

<ol>
  <li>If the navigation is aborted for any of the following reasons, abort
    these steps.
    <ol style="list-style-type:lower-alpha;">
      <li>The navigation is aborted due to the
        <a href="http://www.w3.org/TR/html5/browsers.html#sandboxed-navigation-browsing-context-flag">sandboxed
        navigation browsing context flag</a> or the
        <a href="http://www.w3.org/TR/html5/browsers.html#sandboxed-top-level-navigation-browsing-context-flag">sandboxed
        top-level navigation browsing context flag</a>, or a preexist attempt
        to navigate the <a href="http://www.w3.org/TR/html5/browsers.html#browsing-context">browsing context</a>.</li>
      <li>The navigation is caused by <a href="http://www.w3.org/TR/html5/browsers.html#navigate-fragid-step" title="fragment identifiers navigation">fragment
        identifiers</a> within the page.</li>
      <li>The new resource is to be handled by some sort of inline
      content.</li>
      <li>The new resource is to be handled using a mechanism that does not
        affect the browsing context.</li>
      <li>The user <a href="http://www.w3.org/TR/html5/browsers.html#refused-to-allow-the-document-to-be-unloaded">refuses
        to allow the document to be unloaded</a>.</li>
    </ol>
  </li>
  <li id="step-create-object">Create a new <a>PerformanceNavigationTiming</a> object.
  </li>
  <li>Set <a href="#widl-PerformanceNavigationTiming-name">name</a> to the <code>DOMString</code> "<code>document</code>".</li>
  <li>Set <a href="#widl-PerformanceNavigationTiming-entryType">entryType</a> to the <code>DOMString</code> "<code>navigation</code>".</li>
  <li>Set <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a> to a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a> with a time value of zero, and <a href="#widl-PerformanceNavigationTiming-nextHopProtocol">nextHopProtocol</a> to the empty <code>DOMString</code>.</li>
  <li> Record the current navigation type in <a href="#widl-PerformanceNavigationTiming-type">type</a>
    if it has not been set:
    <ol style="list-style-type:lower-alpha;">
    <li>If the navigation was started by clicking on a link, or entering the URL in the user
        agent's address bar, or form submission, or initializing through a script operation other than the
        <a href="http://www.w3.org/TR/html5/browsers.html#dom-location-reload">location.reload()</a> method,
        let the navigation type be the <code>DOMString</code> "<a href="#idl-def-NavigationType.navigate">navigate</a>".</li>
    <li>If the navigation was started either as a result of a
        <a href="http://www.w3.org/TR/html5/document-metadata.html#attr-meta-http-equiv-refresh" title="Refresh pragma directive">meta refresh</a>,
        or the <a href="http://www.w3.org/TR/html5/browsers.html#dom-location-reload">location.reload()</a>
        method, or other equivalent actions, let the navigation type
        be the <code>DOMString</code> "<a href="#idl-def-NavigationType.reload">reload</a>".</li>
    <li>If the navigation was started as a result of
        <a href="http://www.w3.org/TR/html5/browsers.html#traverse-the-history">history traversal</a>,
        let the navigation type be the <code>DOMString</code> "<a href="#idl-def-NavigationType.back_forward">back_forward</a>".</li>
    </ol>
  </li>
  <li>If the current document and the previous document are from different
    <a href="http://tools.ietf.org/html/rfc6454" title="origin">origins</a>,
    set both <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventStart</a> and
    <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventEnd</a> to 0 then go to step
    <a href="#step-linknegotiation-start">9</a>. Otherwise, record <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventStart</a>
    as the time immediately before the unload event.</li>
  <li>Immediately after the unload event is completed, record the current time as <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventEnd</a>. If the navigation URL has an <a href="http://www.w3.org/TR/service-workers/#dfn-active-worker">active worker registration</a>, immediately before the user agent <a href="http://www.w3.org/TR/service-workers/#service-worker-concept">runs the worker</a> record the time as <a href="#widl-PerformanceResourceTiming-workerStart">workerStart</a>, or if the worker is available, record the time before the <a href="http://www.w3.org/TR/service-workers/#on-fetch-request-algorithm">event named `fetch` is fired</a> at the active worker. Otherwise, if the navigation URL has no matching <a href="http://www.w3.org/TR/service-workers/#dfn-service-worker-registration">service worker registration</a>, set <a href="#widl-PerformanceResourceTiming-workerStart">workerStart</a> value to zero.</li>
  <li id="step-linknegotiation-start">If the navigation requires the network interface to be powered on or cycled, record the time immediately before doing that as <a href="#widl-PerformanceNavigationTiming-linkNegotiationStart">linkNegotiationStart</a>, and record the time immediately after the network interface becomes available as <a href="#widl-PerformanceNavigationTiming-linkNegotiationEnd">linkNegotiationEnd</a>. If the network interface was immediately available, let <a href="#widl-PerformanceNavigationTiming-linkNegotiationStart">linkNegotiationStart</a> and <a href="#widl-PerformanceNavigationTiming-linkNegotiationEnd">linkNegotiationEnd</a> be the same value as <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a>.</li>
  <li id="step-fetch-start">If the new resource is to be fetched using HTTP GET
    or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-get" title="HTTP GET method equivalence">equivalent</a>,
    immediately before a user agent checks with the <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">
    relevant application caches</a>, record the current time as
    <a href="#widl-PerformanceNavigationTiming-fetchStart">fetchStart</a>. Otherwise, immediately before a user agent starts the
    <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title="fetch">
    fetching process</a>, record the current time as <a href="#widl-PerformanceNavigationTiming-fetchStart">fetchStart</a>.</li>
  <li>Let <a href="#widl-PerformanceNavigationTiming-domainLookupStart">domainLookupStart</a>, <a href="#widl-PerformanceNavigationTiming-domainLookupEnd">domainLookupEnd</a>, <a href="#widl-PerformanceNavigationTiming-connectStart">connectStart</a> and <a href="#widl-PerformanceNavigationTiming-connectEnd">connectEnd</a> be the same value as <a href="#widl-PerformanceNavigationTiming-fetchStart">fetchStart</a>.</li>
  <li>If the resource is fetched from the <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
    application cache</a> or local resources, including the
    <a href="https://tools.ietf.org/html/rfc7234">HTTP cache</a> [[RFC7234]],
    go to step <a href="#step-request-start">17</a>.</li>
  <li>If no domain lookup is required, go to step <a href="#step-connect-start">15</a>. Otherwise, immediately before a user
    agent starts the domain name lookup, record the time as
    <a href="#widl-PerformanceNavigationTiming-domainLookupStart">domainLookupStart</a>. </li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-domainLookupEnd">domainLookupEnd</a>
    immediately after the domain name lookup is successfully done. A user
    agent MAY need multiple retries before that. If the domain lookup fails,
    abort the rest of the steps. </li>
  <li id="step-connect-start">If a persistent transport connection is used to
    fetch the resource, let <a href="#widl-PerformanceNavigationTiming-connectStart">connectStart</a> and
    <a href="#widl-PerformanceNavigationTiming-connectEnd">connectEnd</a> be the same value of
    <a href="#widl-PerformanceNavigationTiming-domainLookupEnd">domainLookupEnd</a>.
    Otherwise, record the time as <a href="#widl-PerformanceNavigationTiming-connectStart">connectStart</a> immediately before initiating
    the connection to the server and record the time as
    <a href="#widl-PerformanceNavigationTiming-connectEnd">connectEnd</a> immediately
    after the connection to the server or the proxy is established. A user agent MAY
    need multiple retries before this time. Once connection is established set the value of <a href="#widl-PerformanceNavigationTiming-nextHopProtocol">nextHopProtocol</a> to the ALPN ID used by the connection. If a connection can not be established, abort the rest of the steps. </li>
  <li>A user agent MUST also
    set the
    <a href="#widl-PerformanceNavigationTiming-secureConnectionStart">secureConnectionStart</a> attribute as follows:
    <ol>
    <li>When a secure transport is used, the user agent MUST
        record the time as <a href="#widl-PerformanceNavigationTiming-secureConnectionStart">secureConnectionStart</a>
        immediately before the handshake process to secure the connection.</li>
    <li>When a secure transport is not used, the user agent MUST
        set the value of <a href="#widl-PerformanceNavigationTiming-secureConnectionStart">secureConnectionStart</a> to 0.</li>
    </ol></li>
  <li id="step-request-start">Immediately before a user agent starts sending
    request for the document, record the current time as <a href="#widl-PerformanceNavigationTiming-requestStart">requestStart</a>.</li>
  <li id="step-response-start">Record the time as <a href="#widl-PerformanceNavigationTiming-responseStart">
    responseStart</a> immediately after the user agent receives the first byte
    of the response.</li>
  <li id="step-response-end">Record the time as <a href="#widl-PerformanceNavigationTiming-responseEnd">responseEnd</a> immediately after receiving the
    last byte of the response.
    <ol>
    <li>Return to step <a href="#step-connect-start">15</a> if the user agent fails to send the request or receive the entire response, and needs to
    reopen the connection.

    <div class="note">
    <p>When <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent
    connection</a> [[!RFC7230]] is enabled, a user agent MAY first try to re-use an open
    connect to send the request while the connection can be <a href="https://tools.ietf.org/html/rfc7230#section-6.5">asynchronously
    closed</a>. In such case, connectStart, connectEnd and requestStart SHOULD represent
    timing information collected over the re-open connection.</p>
    </div></li>
    <li>Set the value of <a href="#widl-PerformanceNavigationTiming-transferSize">transferSize</a>, <a href="#widl-PerformanceNavigationTiming-encodedBodySize">encodedBodySize</a>, <a href="#widl-PerformanceNavigationTiming-decodedBodySize">decodedBodySize</a> to corresponding values.</li>
    </ol>
  </li>
  <li>If the fetched resource results in an HTTP redirect or
    <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title="HTTP response codes equivalence">equivalent</a>,
    then
    <ol style="list-style-type:lower-alpha;">
      <li>if the current document and the document that is redirected to are not from the
        same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
        set <a href="#widl-PerformanceNavigationTiming-redirectStart">redirectStart</a>,
        <a href="#widl-PerformanceNavigationTiming-redirectEnd">redirectEnd</a>,
        <a href="#widl-PerformanceNavigationTiming-unloadEventStart">unloadEventStart</a>,
        <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventEnd</a> and
        <a href="#widl-PerformanceNavigationTiming-redirectCount">redirectCount</a> to 0. Then,
        return to step <a href="#step-linknegotiation-start">9</a> with the new resource.</li>
      <li>if there is previous redirect involving documents that are not from the
        same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
        set <a href="#widl-PerformanceNavigationTiming-redirectStart">redirectStart</a>,
        <a href="#widl-PerformanceNavigationTiming-redirectEnd">redirectEnd</a>,
        <a href="#widl-PerformanceNavigationTiming-unloadEventStart">unloadEventStart</a>,
        <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventStart</a> and
        <a href="#widl-PerformanceNavigationTiming-redirectCount">redirectCount</a> to 0. Then,
        return to step <a href="#step-linknegotiation-start">9</a> with the new resource.</li>
      <li>Increment <a href="#widl-PerformanceNavigationTiming-redirectCount">redirectCount</a> by 1.</li>
      <li>If the value of <a href="#widl-PerformanceNavigationTiming-redirectStart">redirectStart</a> is 0,
        let it be the value of <a href="#widl-PerformanceNavigationTiming-fetchStart">fetchStart</a>.</li>
      <li>Let <a href="#widl-PerformanceNavigationTiming-redirectEnd">redirectEnd</a> be the value of
        <a href="#widl-PerformanceNavigationTiming-responseEnd">responseEnd</a>.</li>
      <li>Set all the attributes in window.performance.timing to 0 except
        <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a>,
        <a href="#widl-PerformanceNavigationTiming-redirectStart">redirectStart</a>,
        <a href="#widl-PerformanceNavigationTiming-redirectEnd">redirectEnd</a>,
        <a href="#widl-PerformanceNavigationTiming-unloadEventStart">unloadEventStart</a> and
        <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventEnd</a>.</li>
      <li>Return to step <a href="#step-linknegotiation-start">9</a> with the new resource.</li>
    </ol>
  </li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-domLoading">domLoading</a> immediately
    before the user agent sets the <a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
    document readiness</a> to "loading".</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-domInteractive">domInteractive</a>
    immediately before the user agent sets the <a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
    document readiness</a> to "interactive".</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-domContentLoadedEventStart">domContentLoadedEventStart</a> immediately before the
    user agent fires the <a href="http://www.w3.org/TR/html5/syntax.html#the-end">DOMContentLoaded event</a> at the document.</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-domContentLoadedEventEnd">domContentLoadedEventEnd</a> immediately after
    the <a href="http://www.w3.org/TR/html5/syntax.html#the-end">
    DOMContentLoaded event</a> completes.</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-domComplete">domComplete</a>
    immediately before the user agent sets the <a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
    document readiness</a> to "complete".</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-loadEventStart">loadEventStart</a>
    immediately before the user agent fires the load event.</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-loadEventEnd">loadEventEnd</a>
    immediately after the user agent completes the load event.</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-prerenderSwitch">prerenderSwitch</a>
    immediately after the user agent changes the <a href="http://www.w3.org/TR/page-visibility/#dom-document-visibilitystate">visibilityState</a>
    from <code>prerender</code> to <code>visible</code>. Otherwise, set this attribute to 0.</li>
  <li>
    Set the <a href="#widl-PerformanceNavigationTiming-duration">duration</a> to a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>
	equal to the difference between <a href="#widl-PerformanceNavigationTiming-loadEventEnd">loadEventEnd</a> and <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a>, respectively.
  </li>
</ol>

<p>Some user agents maintain the DOM structure of the document in memory
during navigation operations such as forward and backward. In those cases,
the <a>PerformanceNavigationTiming</a> object MUST NOT
be altered during the navigation. Also note that the while the graph above suggests that link negotiation happens before handling a redirect or checking the local caches, in some situations, it MAY happen after those steps. For example, if the current navigation results in a redirect which is present in the local cache, but the target of the redirect is not present in the local cache, the user agent MAY turn on the network interface after processing the redirect and just before it starts to fetch the redirect target from the network.</p>
</section>

<section id="vendor-prefixes">
<h3>Vendor Prefixes</h3>
<p>Vendor-specific proprietary user agent extensions are discouraged. If such extensions are needed,
e.g., for experimental purposes, vendors MUST use the following extension mechanisms:</p>

<ul>
<li>If the extension to be added is an navigation type, the new type MUST
  <ul>
  <li>return a <code>DOMString</code> in the following naming convention: [vendorprefix]_[type], where [vendorprefix] is a name
  that identifies the vendor.</li>
  </ul>
</li>
<li>If the extension is a new timing attribute, it MUST
  <ul>
  <li>follow the naming convention: [vendorprefix]TimeAttribute, where [vendorprefix] identifies
  the vendor name and TimeAttribute identifies the name of the timing attribute.</li>
  <li>return its time value in a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a>.</li>
  </ul>
</li>
</ul>
</section>
</section><section id='informative' class='informative'>
<h2>Privacy</h2>

<section id="info_disclosure">
<h3>Information disclosure</h3>

<p>There is the potential for disclosing an end-user's browsing and activity history by using
carefully crafted timing attacks. For instance, the unloading time reveals how long the previous
page takes to execute its unload handler, which could be used to infer the user's login status.
These attacks have been mitigated by enforcing the same
<a href="http://tools.ietf.org/html/rfc6454">origin</a> policy when
timing information involving the previous navigation is accessed.</p>

<p>The <a href="http://www.w3.org/TR/html5/browsers.html#relaxing-the-same-origin-restriction">
relaxed same origin policy</a> doesn't provide sufficient protection against unauthorized visits
across documents. In shared hosting, an untrusted third party is able to host an HTTP server at the same
IP address but on a different port.</p>
</section>

<section id="cross-directory">
<h3>Cross-directory access</h3>

<p>Different pages sharing one host name, for example contents from different authors hosted
on sites with user generated content are considered from the same origin because there is no
feature to restrict the access by pathname. Navigating between these pages allows a latter page
to access timing information of the previous one, such as timing regarding redirection and unload event.</p>
</section>
</section><section id='informative' class='informative'>
<h2>Security</h2>

<section id="authentication">
<h3>Detecting proxy servers</h3>
<p>In case a proxy is deployed between the user agent and the web server, the time interval
between the <a href="#widl-PerformanceNavigationTiming-connectStart">connectStart</a> and the
<a href="#widl-PerformanceNavigationTiming-connectEnd">connectEnd</a> attributes indicates the delay between the user agent
and the proxy instead of the web server. With that, web server can potentially infer the
existence of the proxy. For SOCKS proxy, this time interval includes the proxy authentication
time and time the proxy takes to connect to the web server, which obfuscate the proxy detection.
In case of an HTTP proxy, the user agent might not have any knowledge about the proxy server at
all so it's not always feasible to mitigate this attack.</p>
</section>
</section></section><section><h2>User Timing</h2>
      <p>This specification defines an interface to help web
    developers measure the performance of their applications by giving them access
    to high precision timestamps.</p>
    <section id='informative' class='informative'>
    <h2>
        Introduction
    </h2>
    <p>Web developers need the ability to assess and understand the performance characteristics of their
    applications. While JavaScript <a href="#ECMA262">[ECMA262]</a> provides a mechanism to measure application latency (retrieving the current
    timestamp from the <code>Date.now()</code> method), the precision of this timestamp varies between user agents.</p>
    <p>This document defines the <a href="#performancemark"><code>PerformanceMark</code></a> and
	<a href="#performancemeasure"><code>PerformanceMeasure</code></a> interfaces, and extensions to the
	<a href="#extensions-performance-interface"><code>Performance</code></a> interface,
    which expose a high precision timestamp to developers so they can better measure the performance of their applications.</p>

    <section class="informative">
      <p>The following script shows how a developer can use the interfaces defined in this document
  	to obtain timing data related to developer scripts.
      </p>
      <pre class="example highlight">      &lt;!doctype html&gt;
      &lt;html&gt;
        &lt;head&gt;
          &lt;title&gt;User Timing example&lt;/title&gt;
        &lt;/head&gt;
        &lt;body onload="init()"&gt;
          &lt;script&gt;
             function init()
             {
                  performance.mark("startTask1");
                  doTask1(); // Some developer code
                  performance.mark("endTask1");

                  performance.mark("startTask2");
                  doTask2(); // Some developer code
                  performance.mark("endTask2");

                  measurePerf();
             }

             function measurePerf()
             {
                 var perfEntries = performance.getEntriesByType("mark");
                 for (var i = 0; i &lt; perfEntries.length; i++)
                 {
                       if (window.console) console.log("Name: "        + perfEntries[i].name      +
                                                       " Entry Type: " + perfEntries[i].entryType +
                                                       " Start Time: " + perfEntries[i].startTime +
                                                       " Duration: "   + perfEntries[i].duration  + "\n");
                 }
             }
          &lt;/script&gt;
        &lt;/body&gt;
      &lt;/html&gt;
      </pre>
    </section>
  </section><section>
    <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these steps")
    are to be interpreted with the meaning of the key word ("must", "should",
    "may", etc) used in introducing the algorithm. </p>

    <p>Some conformance requirements are phrased as requirements on attributes,
    methods or objects. Such requirements are to be interpreted as requirements
    on user agents. </p>

    <p>Conformance requirements phrased as algorithms or specific steps may be
    implemented in any manner, so long as the end result is equivalent. (In
    particular, the algorithms defined in this specification are intended to be
    easy to follow, and not intended to be performant.) </p>

    <p>The IDL fragments in this specification must be interpreted as
    required for conforming IDL fragments, as described in the Web IDL
    specification. [[!WebIDL]]</p>
  </section><section>
    <h2>Terminology</h2>

    <p>The construction "a <code title="">Foo</code> object", where <code title="">Foo</code> is actually an interface, is sometimes used instead of
    the more accurate "an object implementing the interface <code title="">Foo</code>". </p>

    <p>The term "JavaScript" is used to refer to ECMAScript [[!ECMA-262]], rather than the
    official term ECMAScript, since the term JavaScript is more widely known.
    </p>

    <p>
      Throughout this work, all time values are measured in milliseconds since the start of
      navigation of the document. For example, the start of navigation of the document
      occurs at time 0. The term <i>current time</i> refers to the number of milliseconds
      since the start of navigation of the document until the current moment in time.
      This definition of time is based on the High Resolution Time specification
      [[!hr-time-2]] and is different
      from the definition of time used in the Navigation Timing specification
      [[!navigation-timing-2]],
      where time is measured in milliseconds since midnight of January 1, 1970 (UTC).
    </p>
  </section><section>
    <h2>User Timing</h2>

    <section id="introduction-1" class="informative">
      <h2>Introduction</h2>

      <p>The <a href="#performancemark"><code>PerformanceMark</code></a> and
  	<a href="#performancemeasure"><code>PerformanceMeasure</code></a> interfaces, and extensions to the
  	<a href="#extensions-performance-interface"><code>Performance</code></a> interface,	give web developers access to a high precision, monotonically
         increasing timestamp so they can better measure the performance characteristics of their
         applications.</p>
    </section>

    <section id="extensions-performance-interface">
      <h2> Extensions to the <code>Performance</code> Interface</h2>

      <pre class="idl">    partial interface <a id="performance" href="http://www.w3.org/TR/navigation-timing/#performance">Performance</a> {
      void <a href="#dom-performance-mark">mark</a>(<a class="noxref" href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> markName);
      void <a href="#dom-performance-clearmarks">clearMarks</a>(optional  <a class="noxref" href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> markName);

      void <a href="#dom-performance-measure">measure</a>(<a class="noxref" href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> measureName, optional <a class="noxref" href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> startMark, optional <a class="noxref" href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> endMark);
      void <a href="#dom-performance-clearmeasures">clearMeasures</a>(optional <a class="noxref" href="http://www.w3.org/TR/WebIDL/#idl-DOMString">DOMString</a> measureName);
    };
      </pre>
    <section id="dom-performance-mark" class="methods">
    <h2><code>mark</code> method</h2>
    <p>This method stores a timestamp with the associated name (a "mark").</p>
    <section class="parameters">
        <p><b>Parameters</b></p>
        <p>in <code>markName</code> type of <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString"><code>DOMString</code></a></p>
        <section class="parameterDefinition">
            <p>The name associated with the timestamp.</p>
            <p>Mark names may be re-used within the same document.
            Each call to the <code>mark()</code> method stores a new timestamp
            under the specified mark name.</p>
            <p>The mark name cannot be the same name as any of the attributes in the
            <code><a href="http://www.w3.org/TR/navigation-timing/#performancetiming">PerformanceTiming</a></code> interface [[!navigation-timing-2]].</p>

            <p id="ut-standard-mark-names"><b>Recommended Mark Names</b></p>
            <p>Developers are encouraged to use the following Recommended Mark Names to mark common interactions. The user agent is responsible for storing
                a new timestamp under the specified mark name for Recommended Mark Names, just like any user specified mark name.
                The user agent does not validate that the usage of the Recommended Mark Name is appropriate or consistent with its description.</p>
            <code id="dom-performance-mark-fully-loaded">"mark_fully_loaded"</code>
            <section class="parameterDefinition">
                <p>The time when the page is considered fully loaded as marked by the developer in their application.</p>
            </section>

            <code id="dom-performance-mark-fully-visible">"mark_fully_visible"</code>
            <section class="parameterDefinition">
                <p>The time when the page is considered completely visible to an end-user as marked by the developer in
                their application.</p>
            </section>

            <code id="dom-performance-mark-above-the-fold">"mark_above_the_fold"</code>
            <section class="parameterDefinition">
                <p>The time when all of the content in the visible viewport has been presented to the end-user as marked by
                the developer in their application.</p>
            </section>

            <code id="dom-performance-mark-time-to-user-action">"mark_time_to_user_action"</code>
            <section class="parameterDefinition">
                <p>The time of the first user interaction with the page during or after a navigation, such as scroll or click,
                as marked by the developer in their application.</p>
            </section>
        </section>

        <p><b>No Return Value</b></p>

        <p><b>Exceptions</b></p>
        <p>Throws a <code>SYNTAX_ERR</code> exception if the <em>markName</em> argument is the same name as an attribute in the
        <code><a href="http://www.w3.org/TR/navigation-timing/#performancetiming">PerformanceTiming</a></code> interface.</p>
    </section>
  </section>

  <section class="methods">
    <h4 id="dom-performance-clearmarks"><code>clearMarks</code> method</h4>
    <p>If the <em>markName</em> argument is not specified, this method removes all marks and their associated <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> time values.</p>
    <p>If the <em>markName</em> argument is specified, this method removes all <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> time values for the given mark name.</p>
    <p>If the <em>markName</em> argument is specified but the specified <em>markName</em> does not exist, this method will do nothing.</p>
    <section class="parameters">
        <p><b>Parameters</b></p>
        <p>in <code>markName</code> type of <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString"><code>DOMString</code></a></p>
        <section class="parameterDefinition">
            <p>[optional] The name of the mark whose <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> time values should be cleared.
			If not specified, all marks will be cleared.</p>
        </section>

        <p><b>No Return Value</b></p>

        <p><b>No Exceptions</b></p>
    </section>
  </section>

  <section id="dom-performance-measure" class="methods">
    <h2><code>measure</code> method</h2>
    <p>This method stores the <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> duration between two marks
	along with the associated name (a "measure").</p>
    <p>The behavior of this method depends on which arguments are specified:</p>
    <ul>
        <li>If neither the <em>startMark</em> nor the <em>endMark </em>argument is specified,
            <code>measure()</code> will store the duration as a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> from
            <a href="http://www.w3.org/TR/navigation-timing/#dom-performancetiming-navigationstart">navigationStart</a>
            to the current time.</li>
        <li>If the <em>startMark</em> argument is specified, but the <em>endMark </em>argument is not specified,
            <code>measure()</code> will store the duration as a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
             from the most recent occurrence of the start mark to the current time.</li>
        <li>If both the <em>startMark</em> and <em>endMark </em>arguments are specified, <code>measure()</code> will store the duration as a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> from the most recent occurrence of the start mark to the most recent occurrence of the end mark. The resulting duration value MAY be negative.</li>
    </ul>
    <p>The <em>startMark</em> and <em>endMark</em> arguments may be the name of one of the attributes in the
       <code><a href="http://www.w3.org/TR/navigation-timing/#performancetiming">PerformanceTiming</a></code> interface [[!navigation-timing-2]].
       In this case, the value of that attribute is used as the <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> time value.</p>
    <section class="parameters">
        <p><b>Parameters</b></p>
        <p>in <code>name</code> type of <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString"><code>DOMString</code></a></p>
        <section class="parameterDefinition">
            <p>The name associated with the measure.</p>
            <p>Measure names may be re-used within the same document.
            Each call to the <code>measure()</code> method stores a new duration
            under the specified measure name.</p>
            <p>Measure names live independently from mark names.</p>
        </section>

        <p>in <code>startMark</code> type of <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString"><code>DOMString</code></a></p>
        <section class="parameterDefinition">
            <p>[optional] The name of the start mark.</p>
            <p>If specified, the most recent <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> time value of the start mark is used.</p>
            <p>If not specified, <a href="http://www.w3.org/TR/navigation-timing/#dom-performancetiming-navigationstart">navigationStart</a> is used.</p>
            <p>May be the name of one of the attributes in the
               <code><a href="http://www.w3.org/TR/navigation-timing/#performancetiming">PerformanceTiming</a></code> interface [[!navigation-timing-2]].
               In this case, the value of that attribute is used as the start <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> time value.</p>
        </section>

        <p>in <code>endMark</code> type of <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString"><code>DOMString</code></a></p>
        <section class="parameterDefinition">
            <p>[optional] The name of the end mark.</p>
            <p>If specified, the most recent <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> time value of the end mark is used.</p>
            <p>If not specified, the current time as a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> is used.</p>
            <p>May be the name of one of the attributes in the
               <code><a href="http://www.w3.org/TR/navigation-timing/#performancetiming">PerformanceTiming</a></code> interface [[!navigation-timing-2]].
               In this case, the value of that attribute is used as the end <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> time value.</p>
        </section>

        <p><b>No Return Value</b></p>

        <p><b>Exceptions</b></p>
        <p>Throws a <code>SYNTAX_ERR</code> exception if the start mark or end mark does not exist.</p>
		<p>Throws an <code>INVALID_ACCESS_ERR</code> exception if either <code>startMark</code> or <code>endMark</code> argument, or both, have the same name as a
		   <code><a href="http://www.w3.org/TR/navigation-timing/#performancetiming">PerformanceTiming</a></code> attribute with a time value of 0.</p>
    </section>
  </section>

  <section id="dom-performance-clearmeasures" class="methods">
    <h2><code>clearMeasures</code> method</h2>
    <p>If the <em>measureName</em> argument is not specified, this method removes all measures and their associated <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> durations.</p>
    <p>If the <em>measureName</em> argument is specified, this method removes all <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> durations for the given measure name.</p>
    <p>If the <em>measureName</em> argument is specified but the specified <em>measureName</em> does not exist, this method will do nothing.</p>
    <section class="parameters">
        <p><b>Parameters</b></p>
        <p>in <code>measureName</code> type of <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString"><code>DOMString</code></a></p>
        <section class="parameterDefinition">
            <p>[optional] The name of the measure whose <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> durations should be cleared.
			If not specified, all measures will be cleared.</p>
        </section>

        <p><b>No Return Value</b></p>

        <p><b>No Exceptions</b></p>
    </section>
  </section>
</section>

  <section id="performancemark">
    <h2> The <code>PerformanceMark</code> Interface</h2>

    <pre class="idl">  interface PerformanceMark : <a href="http://www.w3.org/TR/performance-timeline/#performanceentry">PerformanceEntry</a> {
  };
    </pre>

    <p>
    	The <a href="#performancemark">PerformanceMark</a> interface also
		exposes marks created via the <code><a href="#dom-performance-mark">mark()</a></code>
		method to the
    	<a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>[[!performance-timeline]]. The <a href="#performancemark">PerformanceMark</a>
		interface extends the following attributes of the <a href="http://www.w3.org/TR/performance-timeline/#performanceentry">PerformanceEntry</a>
		interface:
    </p>

    <section class="parameters">
        <p>The <code>name</code> attribute will return the mark's name.</p>
        <p>The <code>entryType</code> attribute will return the <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString"><code>DOMString</code></a> <code>mark</code>.</p>
        <p>The <code>startTime</code> attribute will return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
		with the mark's time value [[!hr-time-2]].
    	</p>
        <p>The <code>duration</code> attribute will return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
		of value 0.</p>
    </section>
  </section>

  <section id="performancemeasure">
    <h2>The <code>PerformanceMeasure</code> Interface</h2>

    <pre class="idl">  interface PerformanceMeasure : <a href="http://www.w3.org/TR/performance-timeline/#performanceentry">PerformanceEntry</a> {
  };
    </pre>

	<p>
    	The <a href="#performancemeasure">PerformanceMeasure</a> interface also
		exposes measures created via the <code><a href="#dom-performance-measure">measure()</a></code>
		method to the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a> [[!performance-timeline]]. The <a href="#performancemeasure">PerformanceMeasure</a> interface extends the following attributes of the <a href="http://www.w3.org/TR/performance-timeline/#performanceentry">PerformanceEntry</a> interface:
    </p>

    <section class="parameters">
        <p>The <code>name</code> attribute will return the measure's name.</p>
        <p>The <code>entryType</code> attribute will return the <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString"><code>DOMString</code></a> <code>measure</code>.</p>
        <p>The <code>startTime</code> attribute will return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
		with the measure's start mark [[!hr-time-2]].</p>
        <p>The <code>duration</code> attribute will return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
		with the duration of the measure. </p>
    </section>
  </section>

    <section id="vendor-prefixes">
    <h2>Vendor Prefixes</h2>

    <p>Vendor-specific proprietary user agent extensions are discouraged.
    If such extensions are needed, e.g. for experimental purposes, vendors must use the following extension mechanisms:</p>

    <p>If the extension to be added is a <a href="#ut-standard-mark-names">Standard Mark Name</a>, the Standard Mark Name must:</p>
    <ul>
        <li>Follow this naming convention: [VENDORPREFIX]_[STANDARD_MARK_NAME], where [VENDORPREFIX] is a name that identifies the vendor and [STANDARD_MARK_NAME] is the name given to the Standard Mark.</li>
    </ul>
    </section>
  </section><section>
    <h2>Monotonic Clock</h2>
    <p>The time values stored within the interface <span class="rfc2119">must</span> monotonically increase to ensure they are not
    affected by adjustments to the system clock. The difference between any two chronologically
    recorded time values <span class="rfc2119">must</span> never be negative. The user agent <span class="rfc2119">must</span> record the system clock at the beginning
    of the navigation and define subsequent time values in terms of a monotonic clock measuring time elapsed
    from the beginning of the navigation.
    </p>
  </section><section id='informative' class='informative'>
	<h2>Privacy and Security</h2>

	<p>The interfaces defined in this specification	expose potentially sensitive timing information on specific JavaScript activity of a page.
	However, unlike other interfaces defined in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>,
	the interfaces defined in this specification do not have any restrictions on sharing timing information through script. This is because the web platform has been designed with the invariant that
	any script included on a page has the same access as any other script included on that page regardless of the origin of the script. </p>
</section></section><section><h2>Frame Timing</h2>
      <p>
        This specification defines an interface to help web developers measure the performance of their applications by giving them access to frame performance data to facilitate smoothness (i.e. Frames per Second and Time to Frame) measurements.
      </p>
    <section id='informative' class='informative'>
      <h2>Introduction</h2>
      <p>
        Web developers need the ability to assess and understand the performance characteristics of their applications. While JavaScript [[ECMA-262]] provides a mechanism to approximate application Frames per Second (<dfn>FPS</dfn>) and Time to Frame (<dfn>TTF</dfn>) (by calling a nearly empty <code>requestAnimationFrame</code> [[Animation-Timing]] in a loop), the precision of this method has a high variance. Some example situations where this returns misleading results are:
        </p><ul>
          <li>
            CSS Animations, which can be done off of the main thread and may not impact <code>requestAnimationFrame</code>
          </li>
          <li>
            Scrolling, which can also be handled mostly off of the main thread, and may not impact <code>requestAnimationFrame</code>
          </li>
          <li>
            Slow page loading (such as extensive DOM manipulation), which may consume a lot of time on the rendering thread and allow the main thread to fire a <code>requestAnimationFrame</code> event even though the new content has not yet been displayed to the user.
          </li>
        </ul>
      <p></p>
      <p>
        This document defines the <a href="#performancerendertiming"><code>PerformanceRenderTiming</code></a> and <a href="#performancecompositetiming"><code>PerformanceCompositeTiming</code></a> interfaces, and extensions to the <a href="#extensions-performance-interface"><code>Performance</code></a> interface, which expose frame performance data to be used for smoothness measurements.
      </p>
    </section><section>
      <p>
        Requirements phrased in the imperative as part of algorithms (such as "strip any leading space characters" or "return false and abort these steps") are to be interpreted with the meaning of the key word ("MUST", "SHOULD", "MAY", etc) used in introducing the algorithm.
      </p>
      <p>
        Some conformance requirements are phrased as requirements on attributes, methods or objects. Such requirements are to be interpreted as requirements on user agents.
      </p>
      <p>
        Conformance requirements phrased as algorithms or specific steps may be implemented in any manner, so long as the end result is equivalent. (In particular, the algorithms defined in this specification are intended to be easy to follow, and not intended to be performant.)
      </p>
      <p>
        The IDL fragments in this specification MUST be interpreted as required for conforming IDL fragments, as described in the Web IDL specification. [[!WebIDL]]
      </p>
    </section><section>
      <h2>Terminology</h2>
      <p>
        The construction "a <code>Foo</code> object", where <code>Foo</code> is actually an interface, is sometimes used instead of the more accurate "an object implementing the interface Foo".
      </p>
      <p>
        The term "JavaScript" is used to refer to ECMAScript [[ECMA-262]], rather than the official term ECMAScript, since the term JavaScript is more widely known.
      </p>
    </section><section>
      <h2>Frame Timing</h2>
      <p>
      </p>
      <section class="informative">
        <h2>Introduction</h2>
        <p>The <a>PerformanceRenderTiming</a> and <a>PerformanceCompositeTiming</a> interfaces, and extensions to the <a href="#extensions-performance-interface">Performance interface</a>, enable web developers to measure the performance of their applications by giving them access to frame performance data to facilitate smoothness (i.e. <a>FPS</a> and <a>TTF</a>) measurements:</p>

        <ul>
          <li><a>PerformanceRenderTiming</a> captures the work performed by the renderer to process the frame: DOM modification, JavaScript execution, CSS calculation, and similar activities.</li>
          <li><a>PerformanceCompositeTiming</a> captures events performed by the compositor to place rendered content onto the screen.</li>
        </ul>

        <p>The relationship between <a>PerformanceRenderTiming</a> and <a>PerformanceCompositeTiming</a> events will vary based on the workload, and architecture and configuration of the user agent. For example, the user agent may report many <a>PerformanceCompositeTiming</a> events corresponding to a single <a>PerformanceRenderTiming</a> event due to a CSS animation, composite thread scrolling, or similar activities. Other workloads may result in 1:1 mapping of <a>PerformanceRenderTiming</a> and <a>PerformanceCompositeTiming</a> events, and the exact relationship is also subject to user agent architecture and configuration.</p>
      </section>
      <section id="extensions-performance-interface">
        <h2>Extensions to the <code>Performance</code> Interface</h2>
        <p>
          </p><dl title="partial interface Performance" class="idl">
            <dt>void clearFrameTimings()</dt>
            <dd>
              The method <code>clearFrameTimings</code> clears the buffer used to store the current list of <a href="#performancerendertiming">PerformanceRenderTiming</a> resources.
            </dd>
            <dt>void setFrameTimingBufferSize()</dt>
            <dd>
              <dl class="parameters">
                <dt>unsigned long maxSize</dt>
                <dd>
                  The maxSize parameter sets the maximum number of <a href="#performancerendertiming">PerformanceRenderTiming</a> resources that will be stored in the buffer.
                </dd>
              </dl>
              The <code>setFrameTimingBufferSize</code> method, when invoked, MUST set the maximum number of <a href="#performancerendertiming">PerformanceRenderTiming</a> resources that may be stored in the buffer to the value of the <code>maxSize</code> parameter.
            </dd>
            <dt>attribute EventHandler onframetimingbufferfull</dt>
            <dd>
              The event handler for the <code>frametimingbufferfull</code> event. Immediately after the buffer used to store the list of <a href="#performancerendertiming">PerformanceRenderTiming</a> and <a href="#performancecompositetiming">PerformanceCompositeTiming</a>
    resources becomes full, the User Agent MUST <a href="http://www.w3.org/TR/dom/#concept-event-fire">fire a simple event</a> named <code>frametimingbufferfull</code> that bubbles, isn't cancelable, has no default action, at the
    <a href="http://www.w3.org/TR/navigation-timing-2/#performance">Performance</a> object [[!Navigation-Timing-2]].
            </dd>
          </dl>
        <p></p>
      </section>
      <section id="performancerendertiming">
        <h2>The <code>PerformanceRenderTiming</code> Interface</h2>
        <p>
          The <a>PerformanceRenderTiming</a> interface participates in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a> and extends the following attributes of the <a href="http://www.w3.org/TR/performance-timeline/#performanceentry">PerformanceEntry</a> interface [[!Performance-Timeline]]:
        </p>
          <dl class="attributes">
            <dt id="widl-PerformanceRenderTiming-name"><code>name</code></dt>
            <dd>
              This attribute MUST return the name of the requesting document.
            </dd>
            <dt id="widl-PerformanceRenderTiming-entryType"><code>entryType</code></dt>
            <dd>
              This attribute MUST return the <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString"><code>DOMString</code></a> "<code>render</code>".
            </dd>
            <dt id="widl-PerformanceRenderTiming-startTime"><code>startTime</code></dt>
            <dd>
              This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> with current frame's beginning time value, which is the time that the <code>requestAnimationFrame</code> callback (see [[!Animation-Timing]]) would have fired for the frame. [[!HR-Time]].<p></p>
            </dd>
            <dt id="widl-PerformanceRenderTiming-duration"><code>duration</code></dt>
            <dd>
              This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> with the difference between the end of the frame and the <code>startTime</code> of the frame. The end of the frame is defined as what the beginning time of the next frame's <code>requestAnimationFrame</code> callback (see [[!Animation-Timing]]) would have been, had one been scheduled in the current frame. If a <code>requestAnimationFrame</code> is already requested, its beginning time SHOULD be used.
            </dd>
          </dl>
          <dl title="interface PerformanceRenderTiming : <a href=&quot;http://www.w3.org/TR/performance-timeline/#performanceentry&quot;>PerformanceEntry</a>" class="idl">
            <dt>readonly attribute unsigned long sourceFrameNumber</dt>
            <dd>
              This attribute MUST return the source frame number for the event. This is used to correlate <code>PerformanceRenderTiming</code> and <code>PerformanceCompositeTiming</code> events to measure time-to-frame delays.
            </dd>
            <dt>serializer = { inherit, attribute }</dt>
        </dl>
        <p></p>
      </section>
      <section id="performancecompositetiming">
        <h2>The <code>PerformanceCompositeTiming</code> Interface</h2>
        <p>
          The <a>PerformanceCompositeTiming</a> interface participates in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a> and extends the following attributes of the <a href="http://www.w3.org/TR/performance-timeline/#performanceentry">PerformanceEntry</a> interface [[!Performance-Timeline]]:
        </p>
          <dl class="attributes">
            <dt id="widl-PerformanceCompositeTiming-name"><code>name</code></dt>
            <dd>
              This attribute MUST return the name of the requesting document.
            </dd>
            <dt id="widl-PerformanceCompositeTiming-entryType"><code>entryType</code></dt>
            <dd>
              This attribute MUST return the <a href="http://www.w3.org/TR/WebIDL/#idl-DOMString"><code>DOMString</code></a> "<code>composite</code>".
            </dd>
            <dt id="widl-PerformanceCompositeTiming-startTime"><code>startTime</code></dt>
            <dd>
              This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> with the event's time value [[!HR-Time]].
            </dd>
            <dt id="widl-PerformanceCompositeTiming-duration"><code>duration</code></dt>
            <dd>
              The <code>duration</code> attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> of value 0.
            </dd>
          </dl>
          <dl title="interface PerformanceCompositeTiming : <a href=&quot;http://www.w3.org/TR/performance-timeline/#performanceentry&quot;>PerformanceEntry</a>" class="idl">
            <dt>readonly attribute unsigned long sourceFrameNumber</dt>
            <dd>
              This attribute MUST return the last known source frame number for the event. This is used to correlate <code>PerformanceRenderTiming</code> and <code>PerformanceCompositeTiming</code> events to measure time-to-frame delays.
            </dd>
            <dt>serializer = { inherit, attribute }</dt>
        </dl>
      </section>
    </section><section>
      <h2>Monotonic Clock</h2>
      <p>
        The time values stored within the interface MUST monotonically increase to ensure they are not affected by adjustments to the system clock. The difference between any two chronologically recorded time values MUST never be negative. The user agent MUST record the system clock at the beginning of the navigation and define subsequent time values in terms of a monotonic clock measuring time elapsed from the beginning of the navigation.
      </p>
    </section><section id='informative' class='informative'>
      <h2>Privacy and Security</h2>
      <p>
        The interfaces defined in this specification expose potentially sensitive timing information on specific JavaScript activity of a page. However, unlike other interfaces defined in the Performance Timeline, the interfaces defined in this specification do not have any restrictions on sharing timing information through script. This is because the web platform has been designed with the invariant that any script included on a page has the same access as any other script included on that page regardless of the origin of the script.
      </p>
    </section></section><section><h2>Server Timing</h2>
    <p>This specification introduces <a>Server Timing</a>, which enables the server to communicate performance metrics about the request-response cycle to the user agent, and a JavaScript interface to enable applications to collect, process, and act on these metrics to optimize application delivery.</p>
  <section id='informative' class='informative'>
    <h2>Introduction</h2>

    <p>Accurately measuring performance characteristics of web applications is an important aspect of making web applications faster. [[NAVIGATION-TIMING-2]] and [[RESOURCE-TIMING]] provide detailed request timing information for the document and its resources, which include time when the request was initiated, and various milestones to negotiate the connection and receive the response. However, while the user agent can observe the timing data of the request it has no insight into how or why certain stages of the request-response cycle have taken as much time as they have - e.g. how the request was routed, where the time was spent on the server, and so on.</p>

    <p>This specification introduces <a>Server Timing</a>, which enables the server to communicate performance metrics about the request-response cycle to the user agent, and a JavaScript interface to enable applications to collect, process, and act on these metrics to optimize application delivery.</p>
  </section><section>
    <h2>Server Timing</h2>
    <p><dfn>Server Timing</dfn> constitutes of two parts: a definition of the `Server-Timing` header field, which allows the server to communicate performance metrics and descriptions within the response and in a well defined format, and a `PerformanceServerTiming` interface to allow JavaScript to collect, process, and act on these metrics to optimize application delivery.</p>

    <section>
      <h2>The `Server-Timing` Header Field</h2>

      <p>The <dfn>Server-Timing header field</dfn> is used to communicate one or more metrics and descriptions for the given request-response cycle. The ABNF (Augmented Backus-Naur Form) syntax for the <a>Server-Timing header field</a> is as follows:</p>

      <pre>Server-Timing = "Server-Timing" ":" #server-timing-metric

server-timing-metric   = metric  [ ";" description ]
metric                 = metric-name [ "=" metric-value ]
metric-name            = token
metric-value           = 1\*digit [ "." 1\*digit ]
description            = token | quoted-string
      </pre>

      <ul>
        <li>Each metric MUST have a name.
          <ul>
            <li>Metric names MAY be repeated.</li>
            <li>Metric names are defined by the server.</li>
          </ul>
        </li>
        <li>Each metric MAY have an optional numeric value.</li>
        <li>Each metric MAY have an optional description.</li>
        <li>The user agent MAY surface provided metrics in any order - i.e. the order of metrics in the HTTP header field is not significant.</li>
      </ul>

      <p>See [[!RFC7230]] for definitions of `token`, `digit`, and `quoted-string`.</p>

      <div class="note">
        To minimize the HTTP overhead the provided metrics and descriptions should be kept as short as possible - e.g. use abbreviations and omit optional values where possible.
      </div>

      <div class="note">The server and/or any relevant intermediaries are in full control of which metrics are communicated to the user agent and when. For example, access to some metrics may be restricted due to privacy or security reasons - see <a href="#privacy-and-security"></a> section.</div>
    </section>

    <section>
      <h2>The `PerformanceServerTiming` Interface</h2>
      <p>The <dfn>PerformanceServerTiming</dfn> interface participates in the [[!PERFORMANCE-TIMELINE]] and extends the following attributes of the <a href="http://www.w3.org/TR/performance-timeline/#performanceentry">PerformanceEntry</a> interface:</p>

      <dl class="attributes">
        <dt id="widl-ServerEntry-name">`name`</dt>
        <dd>
          This attribute MUST return the <a href="http://www.w3.org/TR/html5/infrastructure.html#resolve-a-url">resolved URL</a> of the requested resource [[!HTML5]]. This attribute MUST NOT change even if the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch">fetch</a> redirected to a different URL.
        </dd>
        <dt id="widl-ServerEntry-entryType">`entryType`</dt>
        <dd>This attribute MUST return the DOMString "`server`".</dd>
        <dt id="widl-ServerEntry-startTime">`startTime`</dt>
        <dd>This attribute MUST return value 0.</dd>
        <dt id="widl-ServerEntry-duration">`duration`</dt>
        <dd>
          This attribute MUST return a <a href="http://www.w3.org/TR/hr-time/#domhighrestimestamp">DOMHighResTimeStamp</a> [[!HR-TIME]] that contains the server-specified metric value, or value 0.
        </dd>
      </dl>

      <dl title="interface ServerEntry : PerformanceEntry" class="idl">
        <dt>readonly attribute DOMString metric</dt>
        <dd>This attribute MUST return the server-specified metric name.</dd>
        <dt>readonly attribute DOMString description</dt>
        <dd>This attribute MUST return the server-specified metric description, or an empty string.</dd>
        <dt>serializer = { inherit, attribute }</dt>
      </dl>
    </section>

    <section>
      <h2>Extensions to the <code>Performance</code> Interface</h2>
      <dl title="partial interface Performance" class="idl">
        <dt>void clearServerTimings()</dt>
        <dd>This method clears the buffer used to store the current list of <a>PerformanceServerTiming</a> resources.</dd>

        <dt>void setServerTimingBufferSize(unsigned long maxSize)</dt>
        <dd>This method, when invoked, MUST set the maximum number of <a>PerformanceServerTiming</a> resources that may be stored in the buffer to the value of the `maxSize` parameter. The buffer is considered to be full if the number of entries in it is greater than or equal to `maxSize`.

        <p>If this method is not called, the user agent SHOULD store at least 150 <a>PerformanceServerTiming</a> resources in the buffer, unless otherwise specified by the user agent.</p>

        <p>If the `maxSize` parameter is less than the number of elements currently stored in the buffer, no elements in the buffer are to be removed and the user agent MUST NOT fire the `servertimingbufferfull` event.</p>

          <dl class="parameters">
            <dt>unsigned long maxSize</dt>
            <dd>This parameter sets the maximum number of <a>PerformanceServerTiming</a> resources that will be stored in the buffer.</dd>
          </dl>
        </dd>

        <dt>attribute EventHandler onservertimingbufferfull</dt>
        <dd>The event handler for the `servertimingbufferfull` event. Immediately after the buffer used to store the list of <a>PerformanceServerTiming</a> resources becomes full, the user agent MUST fire a simple event named <code>servertimingbufferfull</code> that bubbles, isn't cancelable, has no default action, at the <a href="http://www.w3.org/TR/navigation-timing-2/#idl-def-Performance">Performance</a> object [[!NAVIGATION-TIMING-2]].</dd>
      </dl>
    </section>
  </section><section>
    <h2>Process</h2>
    <section>
      <h2>Processing Model</h2>
      <ol>
        <li>Once the <a href="http://www.w3.org/TR/html5/browsers.html#create-a-document-object">Window object of the current document is created</a> the user agent MUST create a <a href="http://www.w3.org/TR/performance-timeline/#performanceentrylist">PerformanceEntryList</a> object (<dfn>primary buffer</dfn>) to store the list of <a>PerformanceServerTiming</a> resources.</li>
        <li>Set the <a>primary buffer</a> to a size of 150, unless otherwise specified by the user agent or set by the <a href="#widl-Performance-setServerTimingBufferSize-void-unsigned-long-maxSize">setServerTimingBufferSize</a> method.</li>

        <li>For each server-specified metric received via the <a>Server-Timing header field</a> perform the following steps:
          <ol>
            <li id="step-create-object">Create a new <a>PerformanceServerTiming</a> object and set <a href="#widl-ServerEntry-entryType">entryType</a> to the DOMString   `server`.</li>
            <li>Set the <a href="#widl-ServerEntry-name">name</a> to the <a href="http://www.w3.org/TR/html5/infrastructure.html#resolve-a-url">resolved URL</a> of the   requested resource.</li>
            <li>Set <a href="#widl-ServerEntry-metric">metric</a> to the server-specified metric name.</li>
            <li>Set <a href="#widl-ServerEntry-duration">duration</a> to the server-specified metric value, or value 0.</li>
            <li>Set <a href="#widl-ServerEntry-duration">description</a> to the server-specified metric description, or an empty string.</li>
            <li>Set <a href="#widl-ServerEntry-startTime">startTime</a> to the value 0.</li>
            <li>If the <a>primary buffer</a> is full, discard the <a>PerformanceServerTiming</a> object, created in step 3. Otherwise, add it to the <a>primary buffer</a>  . If adding it causes the <a> primary buffer</a> to become full, fire the <a href="#widl-Performance-onservertimingbufferfull">servertimingbufferfull</a>   event at the Document.
              <ol>
                <li>If the <a href="#widl-Performance-clearServerTimings-void">clearServerTimings</a> method is called in the event handler for the <a href="#widl-Performance-onservertimingbufferfull">servertimingbufferfull</a> event, clear all <a>PerformanceServerTiming</a> objects in the <a>primary buffer</a>.</li>
                <li>If the <a href="#widl-Performance-setServerTimingBufferSize-void-unsigned-long-maxSize">setServerTimingBufferSize</a> method is called in the event     handler for the <a href="#widl-Performance-onservertimingbufferfull">servertimingbufferfull</a> event,
                set the maximum size of the <a>primary buffer</a> to the `maxSize` parameter. If the `maxSize` parameter is less than the number of elements currently   stored in the buffer, no elements in the buffer are to be removed.</li>
              </ol>
            </li>
          </ol>
        </li>
      </ol>

      <p>The user-agent MUST process <a>Server-Timing header field</a> communicated via a trailer field (see [[!RFC7230]] section 4.1.2) using the same algorithm.</p>
    </section>

    <section>
      <h2>Cross-origin Resources</h2>
      <p>Cross-origin resources (i.e. non <a href="https://tools.ietf.org/html/rfc6454#section-5">same origin</a>) MUST be included as <a>PerformanceServerTiming</a> objects in the <a href="http://www.w3.org/TR/performance-timeline/#sec-performance-timeline">Performance Timeline</a>. If the "timing allow check" algorithm, as defined in [[RESOURCE-TIMING]], fails for a cross-origin resource:</p>

      <ul>
        <li>The <a href="#widl-ServerEntry-duration">duration</a> MUST be set to value 0.</li>
        <li>The <a href="#widl-ServerEntry-duration">description</a> MUST be set to an empty string.</li>
      </ul>

      <p>Server must return the `Timing-Allow-Origin` HTTP response header, as defined in [[RESOURCE-TIMING]], to allow the user agent to fully expose, to the document origin(s) specified, the values of attributes that would have been set to zero or empty string due to the cross-origin restrictions.</p>
    </section>
  </section><section id='informative' class='informative'>
    <h2>Privacy and Security</h2>

    <p>The interfaces defined in this specification expose potentially sensitive application and infrastructure information to any web page that has included a resource that advertises server timing metrics. For this reason the access to `ServerTiming` interface is restricted by the <a href="http://www.w3.org/TR/html5/browsers.html#same-origin">same origin</a> policy by default, as described in <a href="#cross-origin-resources"></a>. Resource providers can explicitly allow server timing information to be available by adding the `Timing-Allow-Origin` HTTP response header, as defined in [[!RESOURCE-TIMING]], that species the domains that are allowed to access the server metrics.</p>

    <p>In addition to using the `Timing-Allow-Origin` HTTP response header, the server can also use relevant logic to control which metrics are returned, when, and to whom - e.g. the server may only provide certain metrics to correctly authenticated users and nothing at all to all others.</p>
  </section><section>
    <h2>IANA Considerations</h2>
    <p>The permanent message header field registry  should be updated with the following registrations ([[RFC3864]]):</p>

    <section>
      <h2>Server-Timing</h2>
      <dl>
        <dt>Header field name</dt>
        <dd>Server-Timing</dd>
        <dt>Applicable protocol</dt>
        <dd>http</dd>
        <dt>Status</dt>
        <dd>standard</dd>
        <dt>Author/Change controller</dt>
        <dd>W3C</dd>
        <dt>Specification document</dt><dd>This specification (See <a>Server Timing</a> Header Field)</dd>
      </dl>
    </section>
  </section><section id='appendix informative' class='appendix informative'>
    <h2>Examples</h2>
    <section>
    <pre class="example">&gt; GET /resource HTTP/1.1
&gt; Host: example.com

&lt; HTTP/1.1 200 OK
&lt; Server-Timing: miss, db=53, app=47.2;
&lt; Server-Timing: customView, dc;atl
&lt; Trailer: Server-Timing
&lt; (... snip response body ...)
&lt; Server-Timing: total=123.4
      </pre>

      <table class="parameters">
        <thead>
          <tr>
            <th>Name</th>
            <th>Value</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>miss</td><td></td><td></td></tr>
          <tr><td>dc</td><td></td><td>atl</td></tr>
          <tr><td>db</td><td>53</td><td></td></tr>
          <tr><td>app</td><td>47.2</td><td>customView</td></tr>
          <tr><td>total</td><td>123.4</td><td></td></tr>
        </tbody>
      </table>

      <p>The above header fields communicates five distinct metrics that illustrate all the possible ways for the server to communicate data to the user agent: metric name only, metric with value, metric with value and description, and metric with description. For example, the above metrics may indicate that for `example.com/resource` fetch:</p>

      <ol>
        <li>There was a cache miss.</li>
        <li>The request was routed through the "atl" datacenter ("dc").</li>
        <li>The database ("db") time was 53 ms.</li>
        <li>The application server ("app") took 47.2ms to process "customView" template or function.</li>
        <li>The total time for the request-response cycle on the server was 123.4ms, which is recorded at the end of the response and delivered via a trailer field.</li>
      </ol>

      <p>The application can collect, process, and act on the provided metrics via the provided JavaScript interface:</p>

      <pre class="example highlight">      var serverMetrics = window.performance.getEntriesByName('https://example.com/resource.jpg');
      for (i = 0; i &lt; serverMetrics.length; i++) {
          entry = serverMetrics[i];
          if (entry == "server") {
                  // entry.metric, entry.duration, entry.description
          }
      }
      </pre>
    </section>
  </section><section id='appendix informative' class='appendix informative'>
    <h2>Use cases</h2>

    <section>
      <h2>Server timing in developer tools</h2>
      <p>Server processing time can be a significant fraction of the total request time. For example, a dynamic response may require one or more database queries, cache lookups, API calls, time to process relevant data and render the response, and so on. Similarly, even a static response can be delayed due to overloaded servers, slow caches, or other reasons.</p>

      <p>Today, the user agent developer tools are able to show when the request was initiated, and when the first and last bytes of the response were received. However, there is no visibility into where or how the time was spent on the server, which means that the developer is unable to quickly diagnose if there is a performance bottleneck on the server, and if so, in which component. Today, to answer this question, the developer is required to use different techniques: check the server logs, embed performance data within the response (if possible), use external tools, and so on. This makes identifying and diagnosing performance bottlenecks hard, and in many cases impractical.</p>

      <p>Server Timing defines a standard mechanism that enables the server to communicate relevant performance metrics to the client and allows the client to surface them directly in the developer tools - e.g. the requests can be annotated with server sent metrics to provide insight into where or how the time was spent while generating the response.</p>
    </section>

    <section>
      <h2>Server timing for automated analytics</h2>
      <p>In addition to surfacing server sent performance metrics in the developer tools, a standard JavaScript interface enables analytics tools to automatically collect, process, beacon, and aggregate these metrics for operational and performance analysis.</p>
    </section>

    <section>
      <h2>Measuring request routing performance</h2>
      <p>Server Timing enables origin servers to communicate performance metrics about where or how time is spent while processing the request. However, the same request and response may also be routed through one or more multiple proxies (e.g. cache servers, load balancers, and so on), each of which may introduce own delays and may want to provide performance metrics into where or how the time is spent.</p>

      <p>For example, a CDN edge node may want to report which data center was being used, if the resource was available in cache, and how long it took to retrieve the response from cache or from the origin server. Further, the same process may be repeated by other proxies, thus allowing full end-to-end visibility into how the request was routed and where the time was spent.</p>

      <p>Similarly, when a Service Worker is active, some or all of the navigation and resource requests may be routed through it. Effectively, an active Service Worker is a local proxy that is able to reroute requests, serve cached responses, synthesize responses, and more. As a result, Server Timing enables Service Worker to report custom performance metrics about how the request was processed: whether it was fetched from server or server from local cache, duration of relevant the processing steps, and so on.</p>
    </section>
  </section></section><section class='appendix'><h2>Acknowledgments</h2>
<h2>Acknowledgments</h2>
<p>We would like to sincerely thank Karen Anderson, Darin Fisher, Tony Gentilcore,
Nic Jansma, Kyle Scholz, Jonas Sicking, James Simonsen, Steve Souders,
Annie Sullivan, Sigbjørn Vik, Jason Weber to acknowledge their contributions to this work.</p>

<h2>Acknowledgments</h2>

<p>We would like to offer my sincere thanks to James Simonsen, Tony Gentilcore, Zhiheng Wang, Karen Anderson and Jason Weber for all their contributions to this work.</p>

      <h2>Acknowledgments</h2>

    <p>Thanks to Karen Anderson, Tony Gentilcore, Nic Jansma, James Simonsen, Steve Souders, Sigbjorn Vik, and Jason Weber for their useful comments that led to changes to this specification and their contributions to this work.</p>
  
      <h2>Acknowledgments</h2>
      <p>
        Thanks to Enne Walker, Rick Byers, Chris Harrelson, Timothy Robert Ansell, Vladimir Levin, and Nat Duca for their helpful comments and contributions to this work.
      </p>
    
    <h2>Acknowledgments</h2>
    <p>This document reuses text from the [[NAVIGATION-TIMING-2]], [[RESOURCE-TIMING]], [[PERFORMANCE-TIMELINE]], and [[RFC6797]] specifications as permitted by the licenses of those specifications.</p>
  </section></body></html>